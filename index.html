<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Portal corporativo de ferramentas IS-FIELD do Mercado Livre - Acesso centralizado a links, sistemas e recursos internos.">
  <meta name="author" content="IS-FIELD Team - Mercado Livre">

  <!-- SeguranÃ§a extra (sem custo) -->
  <meta name="referrer" content="no-referrer">
  <meta http-equiv="X-Content-Type-Options" content="nosniff">

  <title>IS Tools | Portal Corporativo - Mercado Livre</title>
  <link rel="icon" href="https://i.imgur.com/U0qdo1j.png">

  <!-- Google Fonts: Inter -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">

  <!-- QRCode.js Library -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

  <style>
    :root {
      --ml-yellow: #FFE600;
      --ml-yellow-dark: #E6D000;
      --ml-yellow-darker: #CCB800;
      --ml-yellow-light: #FFF4B3;
      --ml-yellow-ultralight: #FFFCE5;
      --ml-yellow-glow: rgba(255, 230, 0, 0.35);

      --ml-blue: #2D3277;
      --ml-blue-light: #4A54A8;
      --ml-blue-lighter: #6B76C0;
      --ml-blue-ultralight: #E8EAFF;
      --ml-blue-dark: #1F2454;
      --ml-blue-darker: #141833;
      --ml-blue-glow: rgba(45, 50, 119, 0.35);

      --ml-aqua: #3483FA;
      --ml-aqua-light: #5A9EFB;
      --ml-aqua-dark: #2968C8;
      --ml-aqua-glow: rgba(52, 131, 250, 0.35);

      --ml-text-primary: #1A1A1A;
      --ml-text-secondary: #4A4A4A;
      --ml-text-tertiary: #6E6E6E;
      --ml-text-light: #999999;

      --ml-border-light: #E5E5E5;
      --ml-border-medium: #D0D0D0;
      --ml-background: #F7F7F7;
      --ml-background-dark: #EBEBEB;
      --ml-white: #FFFFFF;
      --ml-glass-bg: rgba(255, 255, 255, 0.75);

      --ml-green: #00A650;
      --ml-green-dark: #008C44;
      --ml-success-bg: #E8F7F0;
      --ml-orange: #FF6D00;
      --ml-orange-light: #FF8C3A;
      --ml-red: #E60023;
      --ml-red-light: #FF3355;

      --shadow-xs: 0 1px 3px rgba(0,0,0,0.06);
      --shadow-sm: 0 2px 8px rgba(0,0,0,0.08);
      --shadow-md: 0 4px 16px rgba(0,0,0,0.10);
      --shadow-lg: 0 8px 28px rgba(0,0,0,0.12);
      --shadow-xl: 0 16px 48px rgba(0,0,0,0.15);
      --shadow-yellow: 0 8px 28px var(--ml-yellow-glow);
      --shadow-blue: 0 8px 28px var(--ml-blue-glow);
      --shadow-aqua: 0 8px 28px var(--ml-aqua-glow);
    }

    :root[data-theme="dark"] {
      --ml-background: #0F0F0F;
      --ml-background-dark: #060606;
      --ml-white: #1A1A1A;
      --ml-glass-bg: rgba(26, 26, 26, 0.85);
      --ml-text-primary: #E8E8E8;
      --ml-text-secondary: #B8B8B8;
      --ml-text-tertiary: #888888;
      --ml-text-light: #666666;
      --ml-border-light: #333333;
      --ml-border-medium: #444444;
      --ml-blue-ultralight: #1A1D3D;
      --ml-success-bg: #0D2419;
    }

    :root[data-theme="highContrast"] {
      --ml-background: #000000;
      --ml-background-dark: #000000;
      --ml-white: #000000;
      --ml-glass-bg: rgba(0, 0, 0, 0.95);
      --ml-text-primary: #FFFFFF;
      --ml-text-secondary: #FFFFFF;
      --ml-text-tertiary: #FFFF00;
      --ml-text-light: #FFFF00;
      --ml-border-light: #FFFF00;
      --ml-border-medium: #FFFF00;
      --ml-yellow: #FFFF00;
      --ml-blue: #00FFFF;
      --ml-aqua: #00FFFF;
    }

    :root[data-theme="meliClassic"] {
      --ml-yellow: #FFEB3B;
      --ml-yellow-glow: rgba(255, 235, 59, 0.5);
      --ml-blue: #2962FF;
      --ml-blue-glow: rgba(41, 98, 255, 0.5);
      --ml-aqua: #00B0FF;
      --ml-green: #00E676;
      --ml-orange: #FF6F00;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    html, body {
      width: 100%;
      min-height: 100%;
      background: var(--ml-background);
      font-family: 'Inter', 'Segoe UI', 'Helvetica Neue', Helvetica, Arial, sans-serif;
      color: var(--ml-text-primary);
      line-height: 1.6;
      scroll-behavior: smooth;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      transition: background 0.3s ease, color 0.3s ease;
    }

    body.presentation-mode { cursor: none; }
    body.presentation-mode .header-actions,
    body.presentation-mode .breadcrumb-section,
    body.presentation-mode .corporate-footer { display: none; }
    body.presentation-mode .main-container { max-width: 100%; padding: 2rem; }

    .skeleton-card {
      background: linear-gradient(90deg, var(--ml-background) 25%, var(--ml-background-dark) 50%, var(--ml-background) 75%);
      background-size: 200% 100%;
      animation: skeletonLoading 1.5s infinite;
      border-radius: 14px;
      height: 180px;
      border: 2px solid var(--ml-border-light);
    }
    @keyframes skeletonLoading {
      0% { background-position: 200% 0; }
      100% { background-position: -200% 0; }
    }

    .loading-screen {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: linear-gradient(135deg, var(--ml-blue-darker) 0%, var(--ml-blue) 50%, var(--ml-aqua) 100%);
      background-size: 200% 200%;
      animation: gradientShift 3s ease infinite, fadeOut 0.6s ease-in-out 1.3s forwards;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 10000;
    }
    @keyframes gradientShift {
      0%, 100% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
    }
    .loading-container { text-align: center; }
    .loading-logo {
      width: 90px; height: 90px;
      background: var(--ml-white);
      border-radius: 18px;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 15px;
      margin: 0 auto 1.5rem;
      box-shadow: 0 12px 48px rgba(255, 230, 0, 0.6), 0 0 60px rgba(45, 50, 119, 0.6);
      animation: pulse 2s ease-in-out infinite;
    }
    .loading-logo img { width: 100%; height: 100%; object-fit: contain; }
    .loading-text {
      color: var(--ml-white);
      font-size: 1.25rem;
      font-weight: 700;
      letter-spacing: 1px;
      margin-bottom: 0.5rem;
      text-shadow: 0 2px 10px rgba(0,0,0,0.3);
    }
    .loading-subtext { color: rgba(255,255,255,0.9); font-size: 0.95rem; font-weight: 500; }
    .loading-progress {
      width: 200px; height: 4px;
      background: rgba(255,255,255,0.2);
      border-radius: 2px;
      margin-top: 1.5rem;
      overflow: hidden;
    }
    .loading-bar {
      width: 0; height: 100%;
      background: linear-gradient(90deg, var(--ml-yellow), var(--ml-yellow-dark), var(--ml-yellow));
      background-size: 200% 100%;
      animation: loadProgress 1.3s ease-out forwards, shimmerBar 1.5s linear infinite;
      box-shadow: 0 0 20px var(--ml-yellow-glow);
    }
    @keyframes loadProgress { to { width: 100%; } }
    @keyframes shimmerBar {
      0% { background-position: -200% 0; }
      100% { background-position: 200% 0; }
    }
    @keyframes fadeOut { to { opacity: 0; visibility: hidden; } }
    @keyframes pulse {
      0%, 100% {
        transform: scale(1);
        box-shadow: 0 12px 48px rgba(255, 230, 0, 0.6), 0 0 60px rgba(45, 50, 119, 0.6);
      }
      50% {
        transform: scale(1.05);
        box-shadow: 0 16px 56px rgba(255, 230, 0, 0.8), 0 0 80px rgba(45, 50, 119, 0.8);
      }
    }

    @keyframes fadeInModal { from { opacity: 0; } to { opacity: 1; } }
    @keyframes scaleInModal { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }

    /* Tooltip */
    .tooltip {
      background: #333;
      color: #fff;
      border-radius: 8px;
      padding: 0.75rem 1.25rem;
      font-size: 0.9rem;
      font-weight: 600;
      z-index: 10000;
      opacity: 0;
      pointer-events: none;
      box-shadow: var(--shadow-xl);
      animation: tooltipShow 2s ease-in-out forwards;
      position: fixed;
    }
    :root[data-theme="dark"] .tooltip { background: var(--ml-background-dark); border: 1px solid var(--ml-border-medium); }
    @keyframes tooltipShow {
      0% { opacity: 0; transform: translate(-50%, -90%) scale(0.85); }
      10%, 88% { opacity: 1; transform: translate(-50%, -120%) scale(1); }
      100% { opacity: 0; transform: translate(-50%, -100%) scale(0.9); }
    }

    /* ====== HOURLY CAROUSEL (12h) - scrollbar escondida ====== */
    .forecast-last-updated{
      text-align:center;
      margin:-0.5rem 0 1.25rem;
      color:var(--ml-text-tertiary);
      font-weight:800;
      font-size:.95rem;
    }

    .hourly-forecast-section{
      margin-bottom:2.25rem;
      padding:1.5rem;
      border-radius:22px;
      background: linear-gradient(135deg, var(--ml-blue-ultralight), rgba(255,230,0,0.06));
      border:2px solid rgba(45,50,119,0.18);
      box-shadow:0 10px 28px rgba(45,50,119,0.12);
    }

    .hourly-forecast-header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:1rem;
      margin-bottom:1rem;
    }

    .hourly-forecast-title{
      margin:0;
      font-size:1.25rem;
      font-weight:900;
      color:var(--ml-text-primary);
      letter-spacing:-0.5px;
    }

    .hourly-forecast-actions{ display:flex; gap:.5rem; }

    .hourly-nav-btn{
      width:44px; height:44px;
      border-radius:14px;
      border:2px solid var(--ml-blue);
      background:var(--ml-white);
      color:var(--ml-blue);
      font-size:1.6rem;
      font-weight:900;
      cursor:pointer;
      transition:all .2s ease;
      box-shadow:var(--shadow-xs);
    }
    .hourly-nav-btn:hover{
      transform:translateY(-2px);
      background:var(--ml-yellow);
      border-color:var(--ml-yellow-dark);
      color:var(--ml-text-primary);
      box-shadow:var(--shadow-yellow);
    }

    .hourly-carousel{
      display:grid;
      grid-auto-flow:column;
      grid-auto-columns:minmax(140px, 1fr);
      gap:1rem;

      overflow-x:auto;
      overflow-y:hidden;
      padding:.5rem .25rem .75rem;
      scroll-snap-type:x mandatory;
      -webkit-overflow-scrolling: touch;
      outline:none;

      scrollbar-width:none;
      -ms-overflow-style:none;
    }
    .hourly-carousel::-webkit-scrollbar{ display:none; }

    .hourly-card{
      scroll-snap-align:start;
      background:linear-gradient(135deg, var(--ml-white), var(--ml-background));
      border:2px solid var(--ml-border-light);
      border-radius:18px;
      padding:1.15rem;
      text-align:center;
      transition:all .25s ease;
      box-shadow:var(--shadow-xs);
      position:relative;
      overflow:hidden;
    }
    .hourly-card::before{
      content:'';
      position:absolute;
      top:0; left:0;
      width:100%;
      height:5px;
      background:linear-gradient(90deg, var(--ml-blue), var(--ml-yellow), var(--ml-aqua));
      opacity:.85;
    }
    .hourly-card:hover{
      transform:translateY(-6px);
      border-color:var(--ml-yellow);
      box-shadow:0 14px 34px var(--ml-yellow-glow);
    }

    .hourly-time{ font-weight:900; color:var(--ml-text-primary); margin-bottom:.35rem; }
    .hourly-icon{ font-size:2.35rem; margin:.35rem 0 .5rem; filter:drop-shadow(0 6px 10px rgba(0,0,0,.16)); }
    .hourly-temp{ font-size:1.9rem; font-weight:900; letter-spacing:-1px; color:var(--ml-text-primary); }

    .hourly-meta{
      margin-top:.75rem;
      display:grid;
      gap:.35rem;
      font-size:.85rem;
      font-weight:800;
      color:var(--ml-text-tertiary);
    }

    .hourly-rain{
      color:var(--ml-aqua);
      background:rgba(52,131,250,0.10);
      border:1px solid rgba(52,131,250,0.20);
      padding:.2rem .5rem;
      border-radius:10px;
      display:inline-flex;
      gap:.35rem;
      align-items:center;
      justify-content:center;
    }

    .hourly-hint{
      margin-top:.75rem;
      text-align:center;
      font-size:.85rem;
      font-weight:700;
      color:var(--ml-text-tertiary);
    }

    @media (max-width:768px){
      .hourly-forecast-section{ padding:1.25rem; border-radius:18px; }
      .hourly-carousel{ grid-auto-columns:minmax(128px, 1fr); gap:.85rem; }
      .hourly-nav-btn{ display:none; }
    }
    @media (max-width:480px){
      .hourly-carousel{ grid-auto-columns:minmax(118px, 1fr); }
      .hourly-card{ padding:1rem; border-radius:16px; }
      .hourly-temp{ font-size:1.65rem; }
    }
    /* ===========================
   HEADER + THEME + MOBILE NAV
   =========================== */

.corporate-header {
  background: var(--ml-glass-bg);
  backdrop-filter: blur(20px) saturate(180%);
  -webkit-backdrop-filter: blur(20px) saturate(180%);
  border-bottom: 1px solid rgba(0,0,0,0.08);
  box-shadow: var(--shadow-md);
  position: sticky;
  top: 0;
  z-index: 1000;
  animation: slideDown 0.6s ease-out;
  transition: all 0.3s ease;
}
:root[data-theme="dark"] .corporate-header { border-bottom: 1px solid rgba(255,255,255,0.08); }

@keyframes slideDown {
  from { transform: translateY(-100%); opacity: 0; }
  to { transform: translateY(0); opacity: 1; }
}

.header-container {
  max-width: 1400px;
  margin: 0 auto;
  padding: 1rem 2rem;
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 2rem;
}

.brand-section { display:flex; align-items:center; gap:1rem; }

.brand-logo {
  width: 52px;
  height: 52px;
  background: linear-gradient(135deg, var(--ml-yellow) 0%, var(--ml-yellow-dark) 100%);
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: var(--shadow-yellow);
  transition: transform 0.3s ease;
  padding: 8px;
  overflow: hidden;
  animation: breathe 4s ease-in-out infinite;
}
@keyframes breathe { 0%,100%{transform:scale(1);} 50%{transform:scale(1.03);} }
.brand-logo:hover { transform: scale(1.08) rotate(5deg); box-shadow: 0 12px 36px var(--ml-yellow-glow); }
.brand-logo img { width:100%; height:100%; object-fit:contain; }

.brand-info { display:flex; flex-direction:column; }
.brand-title { font-size: 1.35rem; font-weight: 800; color: var(--ml-text-primary); letter-spacing: -0.5px; line-height: 1.2; }
.brand-subtitle { font-size: 0.75rem; color: var(--ml-text-tertiary); text-transform: uppercase; letter-spacing: 1px; font-weight: 600; }

.header-actions { display:flex; gap:1rem; align-items:center; }

/* Theme selector */
.theme-selector { position: relative; }
.theme-toggle {
  width: 44px; height: 44px;
  border-radius: 50%;
  border: 2px solid var(--ml-border-light);
  background: var(--ml-background-dark);
  cursor: pointer;
  transition: all 0.3s ease;
  display:flex; align-items:center; justify-content:center;
  font-size: 1.3rem;
}
.theme-toggle:hover {
  transform: rotate(20deg) scale(1.1);
  background: var(--ml-yellow);
  border-color: var(--ml-yellow-dark);
  box-shadow: var(--shadow-yellow);
}
.theme-dropdown {
  position:absolute;
  top: calc(100% + 0.5rem);
  right: 0;
  background: var(--ml-white);
  border: 2px solid var(--ml-border-light);
  border-radius: 12px;
  padding: 0.75rem;
  min-width: 200px;
  box-shadow: var(--shadow-lg);
  opacity: 0;
  visibility: hidden;
  transform: translateY(-10px);
  transition: all 0.3s cubic-bezier(0.4,0,0.2,1);
  z-index: 1000;
}
.theme-dropdown.active { opacity:1; visibility:visible; transform: translateY(0); }

.theme-option {
  display:flex;
  align-items:center;
  gap:0.75rem;
  padding:0.75rem 1rem;
  border-radius:8px;
  cursor:pointer;
  transition: all 0.2s ease;
  border: 2px solid transparent;
}
.theme-option:hover { background: var(--ml-background); border-color: var(--ml-yellow); }
.theme-option.active { background: var(--ml-yellow-ultralight); border-color: var(--ml-yellow); font-weight: 700; }

.theme-preview {
  width: 32px; height: 32px;
  border-radius: 8px;
  border: 2px solid var(--ml-border-light);
  display:flex; overflow:hidden;
}
.theme-preview-split { flex:1; }
.theme-option-label { flex:1; font-size:0.9rem; color: var(--ml-text-primary); }

/* Hamburger + mobile nav */
.hamburger-menu {
  display:none;
  width:44px; height:44px;
  background: var(--ml-background-dark);
  border: 2px solid var(--ml-border-light);
  border-radius: 10px;
  cursor:pointer;
  font-size:1.5rem;
  color: var(--ml-text-primary);
  transition: all 0.3s ease;
}
.hamburger-menu:hover {
  background: var(--ml-yellow);
  border-color: var(--ml-yellow-dark);
  transform: scale(1.1);
}
.hamburger-menu.active { background: var(--ml-yellow); }

.mobile-nav {
  position: fixed;
  top: 0;
  right: -100%;
  width: 300px;
  height: 100vh;
  background: var(--ml-white);
  box-shadow: -4px 0 20px rgba(0,0,0,0.15);
  z-index: 9999;
  padding: 2rem;
  transition: right 0.4s cubic-bezier(0.4,0,0.2,1);
  overflow-y: auto;
}
.mobile-nav.active { right: 0; }

.mobile-nav-header {
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:2rem;
  padding-bottom:1rem;
  border-bottom:2px solid var(--ml-border-light);
}
.mobile-nav-title { font-size:1.2rem; font-weight:700; color: var(--ml-text-primary); }

.mobile-nav-close {
  width:36px; height:36px;
  background: var(--ml-background-dark);
  border:none;
  border-radius:8px;
  font-size:1.3rem;
  cursor:pointer;
  color: var(--ml-text-primary);
  transition: all 0.3s ease;
}
.mobile-nav-close:hover { background: var(--ml-red); color:#fff; transform: rotate(90deg); }

.mobile-nav-item {
  padding:1rem;
  margin-bottom:0.75rem;
  background: var(--ml-background);
  border-radius:10px;
  border: 2px solid var(--ml-border-light);
  transition: all 0.3s ease;
  cursor:pointer;
}
.mobile-nav-item:hover { border-color: var(--ml-yellow); transform: translateX(5px); }

.mobile-overlay {
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: rgba(0,0,0,0.5);
  backdrop-filter: blur(4px);
  z-index: 9998;
  opacity: 0;
  visibility: hidden;
  transition: all 0.4s ease;
}
.mobile-overlay.active { opacity:1; visibility:visible; }

/* Status */
.connection-status {
  display:flex;
  align-items:center;
  gap:.5rem;
  padding:.5rem 1rem;
  background: var(--ml-success-bg);
  border-radius: 20px;
  font-size:.85rem;
  font-weight:600;
  color: var(--ml-green-dark);
  border: 1px solid rgba(0,166,80,0.2);
}
.status-dot {
  width:8px; height:8px;
  background: var(--ml-green);
  border-radius:50%;
  animation: statusPulse 2s ease-in-out infinite;
  box-shadow: 0 0 10px var(--ml-green);
}
@keyframes statusPulse {
  0%,100% { opacity:1; transform:scale(1); }
  50% { opacity:.6; transform:scale(1.2); }
}

/* Weather widget (header) */
.weather-widget {
  display:flex;
  align-items:center;
  gap:1.25rem;
  padding:1rem 1.75rem;
  background: linear-gradient(135deg, rgba(45, 50, 119, 0.12), rgba(52, 131, 250, 0.08));
  backdrop-filter: blur(30px) saturate(200%);
  -webkit-backdrop-filter: blur(30px) saturate(200%);
  border: 2px solid rgba(45, 50, 119, 0.25);
  border-radius: 32px;
  font-size: .9rem;
  transition: all .4s cubic-bezier(0.4,0,0.2,1);
  cursor: pointer;
  box-shadow: 0 4px 24px rgba(45,50,119,0.15), inset 0 1px 0 rgba(255,255,255,0.2);
  position: relative;
  overflow: hidden;
}
.weather-widget::before{
  content:'';
  position:absolute;
  top:0; left:-100%;
  width:100%; height:100%;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,0.25), transparent);
  transition:left .6s ease;
}
.weather-widget:hover::before{ left:100%; }
.weather-widget:hover{
  background: linear-gradient(135deg, rgba(45, 50, 119, 0.22), rgba(52, 131, 250, 0.15));
  transform: translateY(-5px) scale(1.02);
  box-shadow: 0 10px 40px rgba(45, 50, 119, 0.25), inset 0 1px 0 rgba(255,255,255,0.35);
  border-color: var(--ml-blue);
}
.weather-icon{
  font-size:2.8rem;
  animation: float 3s ease-in-out infinite;
  filter: drop-shadow(0 6px 12px rgba(0,0,0,0.2));
  transition: transform .3s ease;
}
.weather-widget:hover .weather-icon{
  transform: scale(1.2) rotate(8deg);
  animation-play-state: paused;
}
@keyframes float { 0%,100%{ transform: translateY(0);} 50%{ transform: translateY(-8px);} }

.weather-info{ display:flex; flex-direction:column; line-height:1.5; gap:4px; }
.weather-temp{
  font-weight:900;
  color: var(--ml-text-primary);
  font-size:1.5rem;
  letter-spacing:-1px;
  text-shadow: 0 2px 4px rgba(0,0,0,0.1);
  display:flex;
  align-items: baseline;
  gap:.5rem;
}
.weather-feels-like{ font-size:.75rem; font-weight:600; color: var(--ml-text-tertiary); opacity:.8; }
.weather-location{
  font-size:.85rem;
  color: var(--ml-text-secondary);
  font-weight:700;
  text-decoration: underline dotted;
  text-decoration-color: var(--ml-blue);
  text-decoration-thickness:2px;
  display:flex;
  align-items:center;
  gap:.35rem;
}
.weather-description{
  font-size:.8rem;
  color: var(--ml-blue);
  font-weight:800;
  text-transform: capitalize;
  background: rgba(45,50,119,0.12);
  padding:3px 10px;
  border-radius:12px;
  display:inline-block;
  align-self:flex-start;
  border: 1px solid rgba(45,50,119,0.15);
}
.weather-details-mini{
  display:flex;
  gap:1rem;
  font-size:.75rem;
  color: var(--ml-text-tertiary);
  font-weight:600;
}

/* User info header */
.user-info{
  display:flex;
  align-items:center;
  gap:.75rem;
  padding:.5rem 1rem;
  background: var(--ml-background);
  border-radius: 24px;
  transition: all .3s ease;
  cursor:pointer;
  border: 2px solid var(--ml-border-light);
}
.user-info:hover{
  background: var(--ml-yellow-light);
  border-color: var(--ml-yellow);
  transform: translateY(-2px);
  box-shadow: var(--shadow-yellow);
}
.user-avatar{
  width:36px; height:36px;
  background: linear-gradient(135deg, var(--ml-blue), var(--ml-blue-dark));
  color: var(--ml-white);
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:700;
  border: 2px solid var(--ml-yellow);
  box-shadow: 0 0 16px var(--ml-yellow-glow);
}
.user-details{ display:flex; flex-direction:column; line-height:1.3; }
.user-name{ font-weight:700; color: var(--ml-text-primary); font-size:.9rem; }
.user-role{ font-size:.75rem; color: var(--ml-text-tertiary); }

/* Badge + presentation */
.header-badge{
  display:flex;
  align-items:center;
  gap:.5rem;
  padding:.5rem 1rem;
  background: linear-gradient(135deg, var(--ml-yellow), var(--ml-yellow-dark));
  border-radius:24px;
  font-size:.85rem;
  font-weight:700;
  box-shadow: var(--shadow-yellow);
}
.presentation-btn{
  width:44px; height:44px;
  border-radius:50%;
  border:2px solid var(--ml-border-light);
  background: var(--ml-background-dark);
  cursor:pointer;
  transition: all .3s ease;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:1.2rem;
}
.presentation-btn:hover{
  background: var(--ml-aqua);
  color:#fff;
  border-color: var(--ml-aqua-dark);
  transform: scale(1.1);
  box-shadow: var(--shadow-aqua);
}

/* ===========================
   BREADCRUMB + HERO + MAIN
   =========================== */
.breadcrumb-section{ background: var(--ml-background-dark); border-bottom: 1px solid var(--ml-border-light); }
.breadcrumb-container{ max-width: 1400px; margin:0 auto; padding:.75rem 2rem; }
.breadcrumb{ display:flex; align-items:center; gap:.5rem; font-size:.85rem; flex-wrap:wrap; }
.breadcrumb-item{ display:flex; align-items:center; gap:.5rem; color: var(--ml-text-tertiary); }
.breadcrumb-link{ color: var(--ml-blue); text-decoration:none; font-weight:500; position:relative; }
.breadcrumb-link::after{
  content:'';
  position:absolute;
  bottom:-2px; left:0;
  width:0; height:2px;
  background: var(--ml-yellow);
  transition: width .3s ease;
}
.breadcrumb-link:hover::after{ width:100%; }

.hero-section{
  background: linear-gradient(270deg, var(--ml-blue-darker), var(--ml-blue), var(--ml-yellow), var(--ml-aqua));
  background-size: 800% 800%;
  animation: gradientShiftHero 20s ease infinite;
  color: var(--ml-white);
  padding: 4rem 2rem 3rem;
  position: relative;
  overflow:hidden;
}
.hero-section::before{
  content:'';
  position:absolute;
  inset:0;
  background:
    radial-gradient(circle at 20% 50%, var(--ml-yellow-glow) 0%, transparent 50%),
    radial-gradient(circle at 80% 80%, rgba(255,230,0,0.15) 0%, transparent 50%);
  pointer-events:none;
}
@keyframes gradientShiftHero {
  0% { background-position: 0% 50%; }
  25% { background-position: 50% 50%; }
  50% { background-position: 100% 50%; }
  75% { background-position: 50% 50%; }
  100% { background-position: 0% 50%; }
}

.particles{ position:absolute; inset:0; pointer-events:none; }
.particles span{
  position:absolute;
  width:6px; height:6px;
  background: var(--ml-yellow);
  border-radius:50%;
  box-shadow: 0 0 10px var(--ml-yellow-glow);
  animation: floatParticle calc(4s * var(--i)) linear infinite;
  left: calc(15% * var(--i));
  opacity:0;
}
@keyframes floatParticle {
  0% { transform: translateY(100vh) translateX(0) scale(0); opacity:0; }
  10% { opacity:1; }
  90% { opacity:1; }
  100% { transform: translateY(-100vh) translateX(calc(var(--i) * 20px)) scale(1.5); opacity:0; }
}

.hero-container{ max-width: 1400px; margin:0 auto; position:relative; animation: fadeInUp .8s ease-out .4s backwards; }
.hero-top{ display:flex; justify-content:space-between; align-items:center; margin-bottom:2rem; flex-wrap:wrap; gap:1rem; }
.hero-label{
  display:inline-flex;
  align-items:center;
  gap:.5rem;
  background: rgba(255,230,0,0.2);
  backdrop-filter: blur(20px) saturate(180%);
  padding:.6rem 1.2rem;
  border-radius:30px;
  font-size:.85rem;
  font-weight:700;
  border:2px solid var(--ml-yellow);
  text-transform:uppercase;
  letter-spacing:.5px;
  box-shadow: 0 4px 16px var(--ml-yellow-glow);
}
.hero-time{
  display:flex;
  align-items:center;
  gap:.5rem;
  background: rgba(255,255,255,0.15);
  backdrop-filter: blur(20px) saturate(180%);
  padding:.6rem 1.2rem;
  border-radius:30px;
  font-size:.9rem;
  font-weight:600;
  border: 1px solid rgba(255,255,255,0.25);
}
.hero-title{
  font-size: clamp(2.25rem, 5vw, 4rem);
  font-weight: 800;
  margin-bottom:1rem;
  letter-spacing:-1.5px;
  line-height:1.1;
  text-shadow: 0 4px 20px rgba(0,0,0,0.3);
}
.hero-title span{
  background: linear-gradient(90deg, var(--ml-yellow), var(--ml-yellow-light));
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
  background-clip:text;
}
.hero-description{
  font-size: clamp(1.05rem, 2vw, 1.3rem);
  opacity:.95;
  max-width:750px;
  line-height:1.7;
}

.main-container{ max-width:1400px; margin:0 auto; padding:3rem 2rem; animation: fadeIn .8s ease-out .6s backwards; }
@keyframes fadeIn { from{opacity:0;} to{opacity:1;} }
@keyframes fadeInUp { from{transform:translateY(30px); opacity:0;} to{transform:translateY(0); opacity:1;} }
@keyframes slide-in-up { from{transform:translateY(40px); opacity:0;} to{transform:translateY(0); opacity:1;} }

/* Stats */
.stats-dashboard{
  display:grid;
  grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
  gap:1.5rem;
  margin-bottom:3rem;
}
.stat-card{
  background: var(--ml-white);
  border:2px solid var(--ml-border-light);
  border-radius:16px;
  padding:2rem;
  transition: all .3s cubic-bezier(0.4,0,0.2,1);
  position:relative;
  overflow:hidden;
  animation: slide-in-up .6s ease-out backwards;
}
.stat-card::before{
  content:'';
  position:absolute;
  top:0; left:0;
  width:100%;
  height:4px;
  background: linear-gradient(90deg, var(--ml-yellow), var(--ml-blue), var(--ml-aqua));
  transform: scaleX(0);
  transform-origin:left;
  transition: transform .4s ease;
}
.stat-card:hover::before{ transform: scaleX(1); }
.stat-card:hover{
  border-color: var(--ml-yellow);
  box-shadow: 0 12px 32px var(--ml-yellow-glow);
  transform: translateY(-8px);
}
.stat-header{ display:flex; justify-content:space-between; align-items:flex-start; margin-bottom:1.25rem; }
.stat-icon-box{
  width:56px; height:56px;
  background: linear-gradient(135deg, var(--ml-blue-ultralight), rgba(52,131,250,0.15));
  border-radius:14px;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:1.75rem;
  border:2px solid var(--ml-blue);
  color: var(--ml-blue-dark);
  transition: all .3s ease;
}
.stat-card:hover .stat-icon-box{
  background: linear-gradient(135deg, var(--ml-yellow), var(--ml-yellow-dark));
  transform: rotate(8deg) scale(1.1);
  border-color: var(--ml-yellow-dark);
  box-shadow: 0 8px 24px var(--ml-yellow-glow);
  color: var(--ml-text-primary);
}
.stat-trend{
  display:flex;
  align-items:center;
  gap:.35rem;
  font-size:.8rem;
  color: var(--ml-green);
  font-weight:700;
  background: var(--ml-success-bg);
  padding:.35rem .65rem;
  border-radius:16px;
  border:1px solid var(--ml-green);
}
.stat-value{ font-size:2.5rem; font-weight:800; letter-spacing:-1px; margin-bottom:.5rem; }
.stat-label{ font-size:.95rem; color: var(--ml-text-tertiary); font-weight:600; text-transform:uppercase; }

/* Tip card */
.tip-card{
  background: linear-gradient(135deg, var(--ml-blue-ultralight), rgba(255,230,0,0.08));
  border:2px solid var(--ml-blue);
  border-radius:16px;
  padding:2rem;
  margin-bottom:3rem;
  display:flex;
  align-items:center;
  gap:1.5rem;
  animation: slide-in-up .6s ease-out .5s backwards;
  transition: all .3s ease;
  box-shadow: var(--shadow-sm);
}
.tip-card:hover{ transform: translateY(-5px); box-shadow: var(--shadow-blue); border-color: var(--ml-yellow); }
.tip-icon{ font-size:2.5rem; flex-shrink:0; animation: float 3s ease-in-out infinite; }
.tip-title{ font-weight:800; font-size:1.1rem; color: var(--ml-blue); margin-bottom:.25rem; }
.tip-text{ font-size:.95rem; color: var(--ml-text-secondary); line-height:1.7; }
:root[data-theme="dark"] .tip-title { color: var(--ml-aqua-light); }
/* ===========================
   NOTES + REMINDERS + HISTORY
   =========================== */
.reminders-card{
  background: linear-gradient(135deg, var(--ml-blue-ultralight), rgba(255,230,0,0.05));
  border:2px solid var(--ml-blue);
  border-radius:18px;
  padding:2rem;
  margin-bottom:3rem;
  animation: slide-in-up .6s ease-out .6s backwards;
  box-shadow: var(--shadow-blue);
}
.reminders-header{
  display:flex;
  align-items:center;
  justify-content:space-between;
  margin-bottom:1.5rem;
  padding-bottom:1rem;
  border-bottom:3px solid transparent;
  border-image: linear-gradient(90deg, var(--ml-blue), var(--ml-yellow)) 1;
}
.reminders-title{ font-size:1.3rem; font-weight:800; color: var(--ml-text-primary); display:flex; align-items:center; gap:.5rem; }
.add-reminder-btn{
  padding:.65rem 1.25rem;
  background: linear-gradient(135deg, var(--ml-blue), var(--ml-blue-dark));
  border:2px solid var(--ml-blue-dark);
  border-radius:10px;
  font-size:.9rem;
  font-weight:700;
  cursor:pointer;
  transition: all .3s ease;
  color:#fff;
  display:flex;
  align-items:center;
  gap:.5rem;
  box-shadow: var(--shadow-blue);
}
.add-reminder-btn:hover{ transform: translateY(-2px) scale(1.05); box-shadow: 0 8px 24px var(--ml-blue-glow); }
.reminders-list{ display:flex; flex-direction:column; gap:1rem; }
.reminder-item{
  background: var(--ml-white);
  border:2px solid var(--ml-border-light);
  border-radius:12px;
  padding:1.25rem;
  display:flex;
  align-items:center;
  gap:1rem;
  transition: all .3s ease;
}
.reminder-item:hover{ border-color: var(--ml-yellow); box-shadow: var(--shadow-md); transform: translateX(5px); }
.reminder-toggle{
  width:48px;
  height:28px;
  background: var(--ml-border-medium);
  border-radius:20px;
  position:relative;
  cursor:pointer;
  transition: all .3s ease;
}
.reminder-toggle.active{ background: var(--ml-green); }
.reminder-toggle::after{
  content:'';
  position:absolute;
  width:22px;
  height:22px;
  background:#fff;
  border-radius:50%;
  top:3px;
  left:3px;
  transition: all .3s ease;
  box-shadow: 0 2px 4px rgba(0,0,0,0.2);
}
.reminder-toggle.active::after{ left:23px; }
.reminder-info{ flex:1; }
.reminder-title-text{ font-weight:700; font-size:1rem; color: var(--ml-text-primary); margin-bottom:.25rem; }
.reminder-schedule{ font-size:.85rem; color: var(--ml-text-tertiary); font-weight:600; }
.reminder-delete{
  background:transparent;
  border:none;
  color: var(--ml-text-light);
  cursor:pointer;
  font-size:1.3rem;
  padding:.5rem;
  transition: all .2s ease;
}
.reminder-delete:hover{ color: var(--ml-red); transform: scale(1.2); }
.reminders-empty{ text-align:center; padding:3rem; color: var(--ml-text-tertiary); font-size:1rem; }

.notes-card{
  background: linear-gradient(135deg, var(--ml-white), var(--ml-background));
  border:2px solid var(--ml-border-light);
  border-radius:18px;
  padding:2rem;
  margin-bottom:3rem;
  animation: slide-in-up .6s ease-out .55s backwards;
  box-shadow: var(--shadow-md);
}
.notes-header{
  display:flex;
  align-items:center;
  justify-content:space-between;
  margin-bottom:1.5rem;
  padding-bottom:1rem;
  border-bottom:3px solid transparent;
  border-image: linear-gradient(90deg, var(--ml-yellow), var(--ml-blue)) 1;
}
.notes-title{ font-size:1.3rem; font-weight:800; color: var(--ml-text-primary); display:flex; align-items:center; gap:.5rem; }
.add-note-btn{
  padding:.65rem 1.25rem;
  background: linear-gradient(135deg, var(--ml-yellow), var(--ml-yellow-dark));
  border:2px solid var(--ml-yellow-dark);
  border-radius:10px;
  font-size:.9rem;
  font-weight:700;
  cursor:pointer;
  transition: all .3s ease;
  color: var(--ml-text-primary);
  display:flex;
  align-items:center;
  gap:.5rem;
  box-shadow: var(--shadow-yellow);
}
.add-note-btn:hover{ transform: translateY(-2px) scale(1.05); box-shadow: 0 8px 24px var(--ml-yellow-glow); }
.notes-grid{
  display:grid;
  grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
  gap:1rem;
}
.note-item{
  background: var(--ml-white);
  border:2px solid var(--ml-border-light);
  border-radius:12px;
  padding:1.25rem;
  transition: all .3s ease;
  cursor:pointer;
  animation: slide-in-up .4s ease-out backwards;
}
.note-item:hover{ transform: translateY(-5px) rotate(1deg); box-shadow: var(--shadow-lg); border-color: var(--ml-yellow); }
.note-header{ display:flex; justify-content:space-between; align-items:flex-start; margin-bottom:.75rem; }
.note-color{ width:24px; height:24px; border-radius:6px; border:2px solid var(--ml-border-light); }
.note-delete{
  background:transparent;
  border:none;
  color: var(--ml-text-light);
  cursor:pointer;
  font-size:1.2rem;
  padding:.25rem;
  transition: all .2s ease;
}
.note-delete:hover{ color: var(--ml-red); transform: scale(1.2); }
.note-content{ color: var(--ml-text-primary); font-size:.95rem; line-height:1.6; margin-bottom:.75rem; word-wrap:break-word; }
.note-timestamp{ font-size:.75rem; color: var(--ml-text-light); font-weight:600; }
.notes-empty{ text-align:center; padding:3rem; color: var(--ml-text-tertiary); font-size:1rem; }

/* ===========================
   HISTORY
   =========================== */
.history-card{
  background: var(--ml-white);
  border:2px solid var(--ml-border-light);
  border-radius:16px;
  padding:2rem;
  margin-bottom:3rem;
  animation: slide-in-up .6s ease-out .55s backwards;
}
.history-header{ display:flex; align-items:center; justify-content:space-between; margin-bottom:1.5rem; }
.history-title{ font-size:1.2rem; font-weight:700; color: var(--ml-text-primary); display:flex; align-items:center; gap:.5rem; }
.clear-history-btn{
  padding:.5rem 1rem;
  background: var(--ml-background-dark);
  border:2px solid var(--ml-border-light);
  border-radius:8px;
  font-size:.85rem;
  font-weight:600;
  cursor:pointer;
  transition: all .3s ease;
  color: var(--ml-text-secondary);
}
.clear-history-btn:hover{ background: var(--ml-red); color:#fff; border-color: var(--ml-red); transform: scale(1.05); }
.history-list{ display:flex; flex-direction:column; gap:.75rem; }
.history-item{
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:1rem;
  background: var(--ml-background);
  border:2px solid var(--ml-border-light);
  border-radius:10px;
  transition: all .3s ease;
  cursor:pointer;
}
.history-item:hover{ border-color: var(--ml-blue); transform: translateX(5px); box-shadow: var(--shadow-sm); }
.history-item-info{ display:flex; align-items:center; gap:1rem; flex:1; }
.history-item-icon{ font-size:1.3rem; }
.history-item-label{ font-weight:600; color: var(--ml-text-primary); font-size:.95rem; }
.history-item-time{ font-size:.75rem; color: var(--ml-text-tertiary); }
.history-empty{ text-align:center; padding:2rem; color: var(--ml-text-tertiary); font-style: italic; }

/* ===========================
   SEARCH + AUTOCOMPLETE
   =========================== */
.search-section{
  background: var(--ml-white);
  border:2px solid var(--ml-yellow);
  border-radius:18px;
  padding:2.25rem;
  margin-bottom:3rem;
  box-shadow: 0 8px 24px var(--ml-yellow-glow);
  animation: slide-in-up .6s ease-out .6s backwards;
}
.search-header{ margin-bottom:1.75rem; }
.search-title{ font-size:1.25rem; font-weight:700; color: var(--ml-text-primary); margin-bottom:.5rem; letter-spacing:-0.3px; }
.search-subtitle{ font-size:.95rem; color: var(--ml-text-tertiary); }
.search-wrapper{ position:relative; }
.search-input-container{ position:relative; display:flex; align-items:center; }
.search-icon{ position:absolute; left:1.5rem; font-size:1.2rem; color: var(--ml-text-tertiary); pointer-events:none; transition: all .3s ease; }
.search-bar{
  width:100%;
  padding:1.15rem 3.75rem 1.15rem 3.5rem;
  border:2px solid var(--ml-border-medium);
  border-radius:12px;
  font-size:1rem;
  background: var(--ml-background);
  color: var(--ml-text-primary);
  transition: all .3s cubic-bezier(0.4,0,0.2,1);
  font-family: inherit;
  font-weight:500;
}
.search-bar:focus{
  outline:none;
  border-color: var(--ml-blue);
  box-shadow: 0 0 0 4px var(--ml-blue-glow), 0 4px 16px var(--ml-blue-glow);
  transform: translateY(-2px);
  background: var(--ml-white);
}
.search-bar:focus ~ .search-icon{ color: var(--ml-blue); transform: scale(1.15); }
.clear-search-btn{
  position:absolute;
  right:1.25rem;
  background: var(--ml-background-dark);
  border:none;
  width:34px;
  height:34px;
  border-radius:50%;
  cursor:pointer;
  display:none;
  align-items:center;
  justify-content:center;
  color: var(--ml-text-secondary);
  font-size:1.3rem;
  font-weight:700;
  transition: all .3s ease;
}
.clear-search-btn.active{ display:flex; }
.clear-search-btn:hover{ background: var(--ml-yellow); color: var(--ml-text-primary); transform: rotate(90deg) scale(1.1); box-shadow: var(--shadow-yellow); }

.keyboard-hint{
  display:inline-flex;
  align-items:center;
  gap:.35rem;
  font-size:.75rem;
  color: var(--ml-text-light);
  margin-top:.5rem;
}
.keyboard-hint kbd{
  background: var(--ml-background-dark);
  border: 1px solid var(--ml-border-medium);
  border-radius: 4px;
  padding: .15rem .4rem;
  font-family: monospace;
  font-size: .7rem;
  box-shadow: 0 1px 2px rgba(0,0,0,0.1);
}
.search-status{
  margin-top:1rem;
  padding:1rem 1.25rem;
  background: var(--ml-blue-ultralight);
  border-left:4px solid var(--ml-blue);
  border-radius:8px;
  font-size:.95rem;
  color: var(--ml-text-secondary);
  font-weight:600;
}
.search-suggestions{
  position:absolute;
  top:100%; left:0; right:0;
  background: var(--ml-white);
  border:2px solid var(--ml-blue);
  border-radius:14px;
  margin-top:.75rem;
  box-shadow: var(--shadow-xl);
  z-index:100;
  max-height:400px;
  overflow-y:auto;
}
.suggestion-item{
  padding:1.25rem;
  display:flex;
  align-items:center;
  gap:1rem;
  cursor:pointer;
  transition: all .2s ease;
  border-bottom:1px solid var(--ml-border-light);
}
.suggestion-item:hover{ background: var(--ml-yellow-light); transform: translateX(8px); }
.suggestion-icon{ font-size:1.8rem; }
.suggestion-details{ flex:1; }
.suggestion-label{ font-weight:700; color: var(--ml-text-primary); font-size:1rem; margin-bottom:.25rem; }
.suggestion-category{ font-size:.8rem; color: var(--ml-text-tertiary); font-weight:600; }
.suggestion-badge{
  background: var(--ml-yellow);
  color: var(--ml-text-primary);
  padding:.35rem .75rem;
  border-radius:8px;
  font-size:.75rem;
  font-weight:700;
  text-transform: uppercase;
}

/* ===========================
   CONTENT SECTIONS + LINKS
   =========================== */
.content-section{ margin-bottom:3.5rem; }
.section-header{
  display:flex;
  align-items:center;
  gap:1.25rem;
  margin-bottom:1.75rem;
  padding-bottom:1.25rem;
  border-bottom:3px solid transparent;
  border-image: linear-gradient(90deg, var(--ml-yellow) 10%, var(--ml-blue) 90%) 1;
}
.section-icon{
  width:54px; height:54px;
  background: linear-gradient(135deg, var(--ml-blue), var(--ml-blue-dark));
  color: var(--ml-white);
  border-radius:12px;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:1.6rem;
  box-shadow: var(--shadow-blue);
  border:2px solid var(--ml-yellow);
}
.section-title{ font-size:1.65rem; font-weight:700; color: var(--ml-text-primary); margin-bottom:.35rem; letter-spacing:-.7px; }
.section-subtitle{ font-size:.9rem; color: var(--ml-text-tertiary); font-weight:500; }

.links-grid{
  display:grid;
  grid-template-columns: repeat(auto-fill, minmax(360px, 1fr));
  gap:1.25rem;
  perspective: 1000px;
}
.link-card{
  background: var(--ml-white);
  border:2px solid var(--ml-border-light);
  border-radius:14px;
  padding:1.75rem;
  transition: all .2s cubic-bezier(0.4,0,0.2,1);
  position:relative;
  overflow:hidden;
  display:flex;
  flex-direction:column;
  gap:1.25rem;
  transform-style: preserve-3d;
}
.link-card:hover{ border-color: var(--ml-blue); box-shadow: 0 16px 40px var(--ml-blue-glow); }

.link-content{
  display:flex;
  align-items:flex-start;
  gap:1rem;
  flex:1;
  transform: translateZ(20px);
}
.link-icon{
  width:48px; height:48px;
  background: linear-gradient(135deg, var(--ml-blue-ultralight), rgba(52,131,250,0.2));
  border-radius:10px;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:1.4rem;
  flex-shrink:0;
  border:2px solid var(--ml-blue);
  color: var(--ml-blue-dark);
  transition: all .3s ease;
}
.link-card:hover .link-icon{
  background: linear-gradient(135deg, var(--ml-yellow), var(--ml-yellow-dark));
  transform: scale(1.15) rotate(8deg) translateZ(30px);
  border-color: var(--ml-yellow-dark);
  box-shadow: 0 6px 20px var(--ml-yellow-glow);
  color: var(--ml-text-primary);
}
.link-title{ font-weight:700; color: var(--ml-text-primary); margin-bottom:.35rem; font-size:1.05rem; display:block; }
.link-url{
  color: var(--ml-text-tertiary);
  font-size:.8rem;
  overflow:hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  display:block;
  font-weight:500;
}
.link-actions{ display:flex; gap:.75rem; align-items:center; transform: translateZ(10px); }

/* Buttons */
.btn{
  padding:.7rem 1.5rem;
  border-radius:10px;
  font-size:.9rem;
  font-weight:700;
  cursor:pointer;
  border:none;
  transition: all .2s cubic-bezier(0.4,0,0.2,1);
  display:flex;
  align-items:center;
  justify-content:center;
  gap:.5rem;
  text-decoration:none;
  text-transform: uppercase;
  letter-spacing:.3px;
}
.btn-primary{
  background: linear-gradient(135deg, var(--ml-blue), var(--ml-blue-dark), var(--ml-blue));
  background-size: 250% 100%;
  color: var(--ml-white);
  flex:1;
  box-shadow: var(--shadow-blue);
  border:2px solid transparent;
}
.btn-primary:hover{
  transform: translateY(-2px);
  box-shadow: 0 12px 32px var(--ml-blue-glow);
  border-color: var(--ml-yellow);
}
.btn-secondary{
  background: var(--ml-background-dark);
  color: var(--ml-text-secondary);
  width:44px; height:44px;
  padding:0;
  border:2px solid var(--ml-border-light);
}
.btn-secondary:hover{
  background: var(--ml-aqua);
  color: var(--ml-white);
  border-color: var(--ml-aqua-dark);
  transform: scale(1.1);
  box-shadow: var(--shadow-aqua);
}
.btn-qrcode{
  background: linear-gradient(135deg, var(--ml-yellow), var(--ml-yellow-dark));
  color: var(--ml-text-primary);
  width:44px; height:44px;
  padding:0;
  border:2px solid var(--ml-yellow-dark);
  box-shadow: var(--shadow-yellow);
}
.btn-qrcode:hover{
  transform: scale(1.15);
  box-shadow: 0 8px 24px var(--ml-yellow-glow);
}

/* ===========================
   TEXT TEMPLATES
   =========================== */
.text-card{
  background: var(--ml-white);
  border:2px solid var(--ml-border-light);
  border-radius:14px;
  padding:2rem;
  margin-bottom:1.75rem;
  transition: all .3s cubic-bezier(0.4,0,0.2,1);
  position:relative;
  overflow:hidden;
}
.text-card:hover{ border-color: var(--ml-blue); box-shadow: 0 12px 32px var(--ml-blue-glow); transform: translateY(-4px); }
.text-card-header{
  display:flex;
  justify-content:space-between;
  align-items:flex-start;
  margin-bottom:1.5rem;
  gap:1.5rem;
}
.text-card-title{ font-weight:700; color: var(--ml-text-primary); font-size:1.1rem; line-height:1.5; letter-spacing:-.3px; }
.text-badge{
  background: var(--ml-success-bg);
  color: var(--ml-green-dark);
  padding:.5rem 1rem;
  border-radius:8px;
  font-size:.75rem;
  font-weight:700;
  text-transform: uppercase;
  letter-spacing:.5px;
  border:2px solid var(--ml-green);
  white-space: nowrap;
}
.text-content{
  padding:1.5rem;
  background: var(--ml-blue-ultralight);
  border:2px solid rgba(45,50,119,0.2);
  border-radius:12px;
  color: var(--ml-text-primary);
  font-size:.95rem;
  line-height:1.8;
  white-space: pre-wrap;
  font-family: Consolas, Monaco, 'Courier New', monospace;
  cursor:pointer;
  transition: all .3s ease;
  position:relative;
}
.text-content:hover{
  background: var(--ml-white);
  border-color: var(--ml-yellow);
  box-shadow: 0 6px 20px var(--ml-yellow-glow);
  transform: scale(1.01);
}
.copy-feedback-icon{
  position:absolute;
  top:50%;
  left:50%;
  transform: translate(-50%, -50%);
  font-size:3rem;
  color: var(--ml-green);
  opacity:0;
  transition: opacity .4s ease;
  pointer-events:none;
}
.text-content.copied-success{
  border-color: var(--ml-green) !important;
  box-shadow: 0 0 15px rgba(0,166,80,0.5), inset 0 0 10px rgba(0,166,80,0.3) !important;
}
.text-content.copied-success .copy-feedback-icon{ opacity:1; }

/* ===========================
   QR + FORECAST MODALS
   =========================== */
.qrcode-modal, .forecast-modal{
  position:fixed;
  top:0; left:0;
  width:100%; height:100%;
  background: rgba(0,0,0,0.75);
  backdrop-filter: blur(12px);
  display:none;
  align-items:center;
  justify-content:center;
  z-index: 9999;
  animation: fadeInModal .3s ease-out;
}
.forecast-modal{ background: rgba(0,0,0,0.85); backdrop-filter: blur(20px); }
.qrcode-modal.active, .forecast-modal.active{ display:flex; }

.qrcode-modal-content{
  background: var(--ml-white);
  border-radius:20px;
  padding:2rem;
  max-width:400px;
  width:90%;
  box-shadow: var(--shadow-xl);
  text-align:center;
  animation: scaleInModal .3s ease-out;
  border:3px solid var(--ml-yellow);
}
.qrcode-modal-title{ font-size:1.5rem; font-weight:700; margin-bottom:.5rem; }
.qrcode-modal-subtitle{ font-size:.9rem; color: var(--ml-text-tertiary); word-break: break-all; }
.qrcode-container{
  display:flex;
  justify-content:center;
  align-items:center;
  padding:1.5rem;
  background:#fff;
  border-radius:16px;
  margin: 1.5rem 0;
  border:2px solid var(--ml-yellow);
}
.qrcode-close-btn{
  background: linear-gradient(135deg, var(--ml-blue), var(--ml-blue-dark));
  color: var(--ml-white);
  border:2px solid var(--ml-yellow);
  padding:.85rem 2rem;
  border-radius:10px;
  font-size:1rem;
  font-weight:700;
  cursor:pointer;
  transition: all .3s ease;
  box-shadow: var(--shadow-blue);
}
.qrcode-close-btn:hover{ transform: translateY(-2px); box-shadow: 0 12px 32px var(--ml-blue-glow); }

/* Forecast core */
.forecast-modal-content{
  background: var(--ml-white);
  border-radius:28px;
  padding:2.5rem;
  width:90%;
  max-width:1000px;
  box-shadow: 0 32px 80px rgba(0,0,0,0.4);
  animation: scaleInModal .4s cubic-bezier(0.34,1.56,0.64,1);
  border:4px solid var(--ml-blue);
  max-height:92vh;
  overflow-y:auto;
}
.forecast-header{
  margin-bottom:2.5rem;
  text-align:center;
  padding-bottom:1.5rem;
  border-bottom:3px solid transparent;
  border-image: linear-gradient(90deg, var(--ml-blue), var(--ml-yellow), var(--ml-aqua)) 1;
}
.forecast-title{ font-size:2.25rem; font-weight:900; margin-bottom:.75rem; display:flex; align-items:center; justify-content:center; gap:1rem; }
.forecast-subtitle{ font-size:1.2rem; color: var(--ml-text-secondary); font-weight:700; display:flex; align-items:center; justify-content:center; gap:.5rem; }

.forecast-current{
  background: linear-gradient(135deg, rgba(45,50,119,0.12), rgba(52,131,250,0.08), rgba(255,230,0,0.05));
  border:4px solid var(--ml-blue);
  border-radius:24px;
  padding:3rem;
  margin-bottom:2.5rem;
  text-align:center;
  position:relative;
  overflow:hidden;
  box-shadow: 0 12px 40px rgba(45,50,119,0.25), inset 0 2px 0 rgba(255,255,255,0.3);
}
.forecast-current-icon{ font-size:6rem; margin-bottom:1.5rem; }
.forecast-current-temp{ font-size:4.5rem; font-weight:900; margin-bottom:.75rem; letter-spacing:-3px; }
.forecast-current-desc{
  font-size:1.5rem;
  color: var(--ml-blue);
  text-transform: capitalize;
  font-weight:800;
  margin-bottom:2rem;
  padding:.5rem 1.5rem;
  background: rgba(45,50,119,0.1);
  border-radius:16px;
  display:inline-block;
}
.forecast-current-details{
  display:grid;
  grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
  gap:1.5rem;
  margin-top:2rem;
}
.forecast-detail-item{
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:.75rem;
  padding:1.5rem;
  background: var(--ml-white);
  border-radius:16px;
  border:2px solid var(--ml-border-light);
  transition: all .3s ease;
  box-shadow: var(--shadow-xs);
}
.forecast-detail-item:hover{
  transform: translateY(-6px) scale(1.05);
  border-color: var(--ml-yellow);
  box-shadow: 0 10px 28px var(--ml-yellow-glow);
}
.forecast-grid{
  display:grid;
  grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));
  gap:1.5rem;
  margin-bottom:2rem;
}
.forecast-day{
  background: linear-gradient(135deg, var(--ml-white), var(--ml-background));
  border-radius:18px;
  padding:1.75rem 1.25rem;
  text-align:center;
  border:2px solid var(--ml-border-light);
  transition: all .4s cubic-bezier(0.34,1.56,0.64,1);
  box-shadow: var(--shadow-xs);
}
.forecast-day:hover{
  transform: translateY(-10px) scale(1.05);
  border-color: var(--ml-blue);
  box-shadow: 0 16px 40px rgba(45,50,119,0.3);
  background: linear-gradient(135deg, var(--ml-blue-ultralight), rgba(255,230,0,0.1));
}
.forecast-day-name{ font-weight:900; font-size:1rem; margin-bottom:1.25rem; text-transform: uppercase; letter-spacing:.8px; }
.forecast-day-icon{ font-size:3.5rem; margin-bottom:1.25rem; }
.forecast-day-temps{ font-size:.95rem; color: var(--ml-text-tertiary); font-weight:600; display:flex; flex-direction:column; gap:.5rem; }
.forecast-day-temps span{ font-weight:900; color: var(--ml-text-primary); font-size:1.5rem; letter-spacing:-.8px; }
.forecast-day-precip{
  font-size:.8rem;
  color: var(--ml-aqua);
  font-weight:800;
  margin-top:.5rem;
  padding:.25rem .5rem;
  background: rgba(52,131,250,0.1);
  border-radius:8px;
  display:inline-block;
}
.forecast-extra-info{
  display:grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap:1.25rem;
  margin-top:2rem;
  padding-top:2rem;
  border-top:2px solid var(--ml-border-light);
}
.extra-info-card{
  background: linear-gradient(135deg, var(--ml-background), var(--ml-white));
  padding:1.5rem;
  border-radius:14px;
  border:2px solid var(--ml-border-light);
  text-align:center;
  transition: all .3s ease;
}
.extra-info-card:hover{ transform: translateY(-5px); border-color: var(--ml-yellow); box-shadow: var(--shadow-md); }
.extra-info-icon{ font-size:2.5rem; margin-bottom:.75rem; }
.extra-info-label{
  font-size:.85rem;
  color: var(--ml-text-tertiary);
  font-weight:700;
  text-transform: uppercase;
  letter-spacing:.5px;
  margin-bottom:.5rem;
}
.extra-info-value{ font-size:1.8rem; font-weight:900; color: var(--ml-text-primary); letter-spacing:-.5px; }

/* ===========================
   FOOTER + SCROLL TOP
   =========================== */
.scroll-top-btn{
  position:fixed;
  bottom:2rem;
  right:2rem;
  width:56px;
  height:56px;
  background: linear-gradient(135deg, var(--ml-blue), var(--ml-blue-dark));
  color: var(--ml-white);
  border:2px solid var(--ml-yellow);
  border-radius:16px;
  font-size:1.6rem;
  cursor:pointer;
  box-shadow: var(--shadow-blue);
  transition: all .3s cubic-bezier(0.4,0,0.2,1);
  opacity:0;
  visibility:hidden;
  z-index:999;
  display:flex;
  align-items:center;
  justify-content:center;
}
.scroll-top-btn.visible{ opacity:1; visibility:visible; }
.scroll-top-btn:hover{
  background: linear-gradient(135deg, var(--ml-yellow), var(--ml-yellow-dark));
  color: var(--ml-text-primary);
  transform: translateY(-6px);
  box-shadow: 0 16px 40px var(--ml-yellow-glow);
  border-color: var(--ml-yellow-dark);
}

.corporate-footer{
  background: var(--ml-background-dark);
  color: var(--ml-text-secondary);
  padding:2rem;
  margin-top:4rem;
  border-top:2px solid var(--ml-border-light);
}
.footer-container{
  max-width:1400px;
  margin:0 auto;
  display:flex;
  justify-content:space-between;
  align-items:center;
  flex-wrap:wrap;
  gap:1.5rem;
}
.footer-badges{ display:flex; gap:.85rem; flex-wrap:wrap; }
.footer-badge{
  background: var(--ml-background);
  padding:.5rem .9rem;
  border-radius:8px;
  font-size:.8rem;
  font-weight:700;
  border:1px solid var(--ml-border-light);
  transition: all .3s ease;
}
.footer-badge:hover{
  background: var(--ml-yellow);
  color: var(--ml-text-primary);
  transform: translateY(-2px);
  box-shadow: var(--shadow-yellow);
  border-color: var(--ml-yellow);
}

/* Utilities */
.hidden { display:none !important; }
.sr-only{
  position:absolute;
  width:1px; height:1px;
  padding:0; margin:-1px;
  overflow:hidden;
  clip: rect(0,0,0,0);
  white-space: nowrap;
  border:0;
}
mark{
  background-color: var(--ml-yellow);
  color: var(--ml-text-primary);
  padding:2px 4px;
  border-radius:4px;
  font-weight:700;
}

/* Responsive */
@media (max-width: 1024px) {
  .header-container { padding: 1rem 1.5rem; }
  .main-container { padding: 2.5rem 1.5rem; }
  .links-grid { grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); }
  .forecast-current-details { grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); }
}
@media (max-width: 768px) {
  .weather-widget, .header-badge, .connection-status, .presentation-btn, .theme-selector { display:none; }
  .user-details { display:none; }
  .hamburger-menu { display:flex; }
  .hero-section { padding: 3rem 1.5rem 2rem; }
  .hero-top { flex-direction:column; align-items:flex-start; }
  .stats-dashboard, .links-grid { grid-template-columns:1fr; }
  .footer-container { flex-direction:column; text-align:center; }
  .scroll-top-btn { bottom:1.5rem; right:1.5rem; width:50px; height:50px; }
  .forecast-grid { grid-template-columns: repeat(auto-fit, minmax(95px, 1fr)); gap:1rem; }
  .tip-card { flex-direction:column; text-align:center; }
  .notes-grid { grid-template-columns:1fr; }
}
@media (max-width: 480px) {
  .brand-title { font-size: 1.15rem; }
  .hero-title { font-size: 2rem; }
  .search-section, .tip-card, .link-card, .text-card, .history-card, .notes-card, .reminders-card { padding: 1.5rem; }
  .forecast-modal-content { padding: 1.5rem; border-radius: 20px; border-width: 3px; }
  .forecast-current { padding: 2rem 1.25rem; }
  .forecast-current-temp { font-size: 3rem; }
  .forecast-current-desc { font-size: 1.2rem; }
  .forecast-grid { grid-template-columns: repeat(auto-fit, minmax(80px, 1fr)); gap: .75rem; }
}

/* custom scrollbar (global) */
::-webkit-scrollbar { width: 12px; background: var(--ml-background); }
::-webkit-scrollbar-thumb {
  background: linear-gradient(180deg, var(--ml-blue), var(--ml-blue-dark));
  border-radius: 6px;
  border: 2px solid var(--ml-background);
}
::-webkit-scrollbar-thumb:hover { background: linear-gradient(180deg, var(--ml-yellow), var(--ml-yellow-dark)); }

/* noscript */
noscript{
  display:block;
  padding:2rem;
  text-align:center;
  background: var(--ml-yellow-light);
  color: var(--ml-text-primary);
  border:3px solid var(--ml-yellow);
  border-radius:12px;
  margin:2rem;
  font-weight:700;
  font-size:1.05rem;
  box-shadow: var(--shadow-yellow);
}
/* ===========================
   PROFILE MODAL (completo)
   =========================== */
.profile-config-modal {
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: rgba(0, 0, 0, 0.85);
  backdrop-filter: blur(20px);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 10000;
  animation: fadeInModal 0.3s ease-out;
}
.profile-config-modal.active { display: flex; }

.profile-config-content {
  background: var(--ml-white);
  border-radius: 24px;
  padding: 2.5rem;
  width: 90%;
  max-width: 600px;
  box-shadow: 0 32px 80px rgba(0, 0, 0, 0.4);
  animation: scaleInModal 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
  border: 4px solid var(--ml-yellow);
  max-height: 90vh;
  overflow-y: auto;
}

.profile-config-header {
  text-align: center;
  margin-bottom: 2rem;
  padding-bottom: 1.5rem;
  border-bottom: 3px solid transparent;
  border-image: linear-gradient(90deg, var(--ml-yellow), var(--ml-blue)) 1;
}

.profile-config-title {
  font-size: 2rem;
  font-weight: 900;
  color: var(--ml-text-primary);
  margin-bottom: 0.5rem;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.75rem;
}

.profile-config-subtitle {
  font-size: 1rem;
  color: var(--ml-text-secondary);
  font-weight: 600;
}

.profile-form-group { margin-bottom: 1.75rem; }

.profile-form-label {
  display: block;
  font-weight: 700;
  font-size: 1.05rem;
  color: var(--ml-text-primary);
  margin-bottom: 0.75rem;
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.profile-form-input {
  width: 100%;
  padding: 1rem 1.25rem;
  border: 2px solid var(--ml-border-medium);
  border-radius: 12px;
  font-size: 1rem;
  background: var(--ml-background);
  color: var(--ml-text-primary);
  transition: all 0.3s ease;
  font-family: inherit;
  font-weight: 500;
}

.profile-form-input:focus {
  outline: none;
  border-color: var(--ml-blue);
  box-shadow: 0 0 0 4px var(--ml-blue-glow);
  background: var(--ml-white);
}

.profile-shift-options,
.profile-days-options {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
  gap: 0.75rem;
}

.profile-shift-option,
.profile-day-option { position: relative; }

.profile-shift-option input,
.profile-day-option input {
  position: absolute;
  opacity: 0;
  width: 0; height: 0;
}

.profile-shift-label,
.profile-day-label {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 1rem;
  border: 2px solid var(--ml-border-medium);
  border-radius: 12px;
  background: var(--ml-background);
  cursor: pointer;
  transition: all 0.3s ease;
  text-align: center;
  min-height: 80px;
}

.profile-shift-label:hover,
.profile-day-label:hover {
  border-color: var(--ml-blue);
  transform: translateY(-3px);
  box-shadow: var(--shadow-md);
}

.profile-shift-option input:checked + .profile-shift-label,
.profile-day-option input:checked + .profile-day-label {
  background: linear-gradient(135deg, var(--ml-yellow), var(--ml-yellow-dark));
  border-color: var(--ml-yellow-dark);
  font-weight: 700;
  box-shadow: var(--shadow-yellow);
}

.profile-shift-name,
.profile-day-name {
  font-weight: 700;
  font-size: 1rem;
  color: var(--ml-text-primary);
  margin-bottom: 0.25rem;
}

.profile-shift-time {
  font-size: 0.8rem;
  color: var(--ml-text-tertiary);
  font-weight: 600;
}

.profile-day-short {
  font-size: 0.75rem;
  color: var(--ml-text-tertiary);
  font-weight: 600;
  margin-top: 0.25rem;
}

.profile-form-actions {
  display: flex;
  gap: 1rem;
  margin-top: 2rem;
}

.profile-btn-save,
.profile-btn-cancel {
  flex: 1;
  padding: 1rem 2rem;
  border-radius: 12px;
  font-size: 1rem;
  font-weight: 700;
  cursor: pointer;
  border: none;
  transition: all 0.3s ease;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.profile-btn-save {
  background: linear-gradient(135deg, var(--ml-blue), var(--ml-blue-dark));
  color: #fff;
  box-shadow: var(--shadow-blue);
}

.profile-btn-save:hover {
  transform: translateY(-2px);
  box-shadow: 0 12px 32px var(--ml-blue-glow);
}

.profile-btn-cancel {
  background: var(--ml-background-dark);
  color: var(--ml-text-secondary);
  border: 2px solid var(--ml-border-medium);
}

.profile-btn-cancel:hover {
  background: var(--ml-red);
  color: #fff;
  border-color: var(--ml-red);
  transform: translateY(-2px);
}

/* ===========================
   BREADCRUMB finishing touches
   =========================== */
.breadcrumb-separator { color: var(--ml-text-light); user-select: none; }

/* ===========================
   Animation helpers (usadas)
   =========================== */
@keyframes gradientFlow { 0% { background-position: 0% 50%; } 100% { background-position: 200% 50%; } }
@keyframes slideInLeft { from { transform: translateX(-20px); opacity: 0; } to { transform: translateX(0); opacity: 1; } }

@media (max-width: 768px) {
  .profile-config-content { padding: 2rem 1.5rem; }
  .profile-shift-options, .profile-days-options { grid-template-columns: 1fr; }
  .profile-form-actions { flex-direction: column; }
}
  </style>
</head>

<body>
  <!-- Loading Screen -->
  <div class="loading-screen">
    <div class="loading-container">
      <div class="loading-logo">
        <img src="https://i.imgur.com/U0qdo1j.png" alt="Mercado Livre Logo" loading="eager">
      </div>
      <div class="loading-text">IS TOOLS PORTAL</div>
      <div class="loading-subtext">Mercado Livre - Carregando plataforma...</div>
      <div class="loading-progress">
        <div class="loading-bar"></div>
      </div>
    </div>
  </div>
  <!-- Profile Configuration Modal -->
  <div class="profile-config-modal" id="profileConfigModal" role="dialog" aria-modal="true" aria-labelledby="profileConfigTitle">
    <div class="profile-config-content">
      <div class="profile-config-header">
        <h3 class="profile-config-title" id="profileConfigTitle">
          <span>ð¤</span>
          ConfiguraÃ§Ã£o de Perfil
        </h3>
        <p class="profile-config-subtitle">Personalize suas informaÃ§Ãµes de trabalho</p>
      </div>

      <form id="profileConfigForm">
        <div class="profile-form-group">
          <label class="profile-form-label">
            <span>ð¤</span>
            <span>Nome Completo</span>
          </label>
          <input type="text" id="profileName" class="profile-form-input" placeholder="Digite seu nome completo" required>
        </div>

        <div class="profile-form-group">
          <label class="profile-form-label">
            <span>ð</span>
            <span>Selecione seu Turno</span>
          </label>

          <div class="profile-shift-options">
            <div class="profile-shift-option">
              <input type="radio" id="shift-t1" name="shift" value="T1" required>
              <label for="shift-t1" class="profile-shift-label">
                <span class="profile-shift-name">T1 - ManhÃ£</span>
                <span class="profile-shift-time">05:30 Ã s 14:30</span>
              </label>
            </div>

            <div class="profile-shift-option">
              <input type="radio" id="shift-t4" name="shift" value="T4" required>
              <label for="shift-t4" class="profile-shift-label">
                <span class="profile-shift-name">T4 - Comercial</span>
                <span class="profile-shift-time">08:30 Ã s 17:30</span>
              </label>
            </div>

            <div class="profile-shift-option">
              <input type="radio" id="shift-t2" name="shift" value="T2" required>
              <label for="shift-t2" class="profile-shift-label">
                <span class="profile-shift-name">T2 - Tarde</span>
                <span class="profile-shift-time">13:00 Ã s 22:00</span>
              </label>
            </div>

            <div class="profile-shift-option">
              <input type="radio" id="shift-t3" name="shift" value="T3" required>
              <label for="shift-t3" class="profile-shift-label">
                <span class="profile-shift-name">T3 - Noite</span>
                <span class="profile-shift-time">22:00 Ã s 07:00</span>
              </label>
            </div>
          </div>
        </div>

        <div class="profile-form-group">
          <label class="profile-form-label">
            <span>ð</span>
            <span>Dias que Trabalha (selecione todos)</span>
          </label>
          <div class="profile-days-options">
            <div class="profile-day-option">
              <input type="checkbox" id="day-1" name="workDays" value="1">
              <label for="day-1" class="profile-day-label">
                <span class="profile-day-name">Segunda</span>
                <span class="profile-day-short">SEG</span>
              </label>
            </div>
            <div class="profile-day-option">
              <input type="checkbox" id="day-2" name="workDays" value="2">
              <label for="day-2" class="profile-day-label">
                <span class="profile-day-name">TerÃ§a</span>
                <span class="profile-day-short">TER</span>
              </label>
            </div>
            <div class="profile-day-option">
              <input type="checkbox" id="day-3" name="workDays" value="3">
              <label for="day-3" class="profile-day-label">
                <span class="profile-day-name">Quarta</span>
                <span class="profile-day-short">QUA</span>
              </label>
            </div>
            <div class="profile-day-option">
              <input type="checkbox" id="day-4" name="workDays" value="4">
              <label for="day-4" class="profile-day-label">
                <span class="profile-day-name">Quinta</span>
                <span class="profile-day-short">QUI</span>
              </label>
            </div>
            <div class="profile-day-option">
              <input type="checkbox" id="day-5" name="workDays" value="5">
              <label for="day-5" class="profile-day-label">
                <span class="profile-day-name">Sexta</span>
                <span class="profile-day-short">SEX</span>
              </label>
            </div>
            <div class="profile-day-option">
              <input type="checkbox" id="day-6" name="workDays" value="6">
              <label for="day-6" class="profile-day-label">
                <span class="profile-day-name">SÃ¡bado</span>
                <span class="profile-day-short">SÃB</span>
              </label>
            </div>
            <div class="profile-day-option">
              <input type="checkbox" id="day-0" name="workDays" value="0">
              <label for="day-0" class="profile-day-label">
                <span class="profile-day-name">Domingo</span>
                <span class="profile-day-short">DOM</span>
              </label>
            </div>
          </div>
        </div>

        <div class="profile-form-actions">
          <button type="submit" class="profile-btn-save">ð¾ Salvar ConfiguraÃ§Ãµes</button>
          <button type="button" class="profile-btn-cancel" id="profileCancelBtn">â Cancelar</button>
        </div>
      </form>
    </div>
  </div>

  <!-- QR Code Modal -->
  <div class="qrcode-modal" id="qrcodeModal" role="dialog" aria-modal="true" aria-labelledby="qrcodeTitle">
    <div class="qrcode-modal-content">
      <div class="qrcode-modal-header">
        <h3 class="qrcode-modal-title" id="qrcodeTitle">QR Code do Link</h3>
        <p class="qrcode-modal-subtitle" id="qrcodeUrl">--</p>
      </div>
      <div class="qrcode-container" id="qrcodeContainer"></div>
      <button class="qrcode-close-btn" id="qrcodeCloseBtn">Fechar</button>
    </div>
  </div>

  <!-- Forecast Modal -->
  <div class="forecast-modal" id="forecastModal" role="dialog" aria-modal="true" aria-labelledby="forecastTitle">
    <div class="forecast-modal-content">
      <div class="forecast-header">
        <h3 class="forecast-title" id="forecastTitle">
          <span>ð¤ï¸</span>
          PrevisÃ£o do Tempo
        </h3>
        <p class="forecast-subtitle">
          <span>ð</span>
          <span id="forecastModalLocation">--</span>
        </p>
      </div>

      <div class="forecast-current" id="forecastCurrent">
        <div class="forecast-current-icon" id="forecastCurrentIcon">â³</div>
        <div class="forecast-current-temp" id="forecastCurrentTemp">--Â°C</div>
        <div class="forecast-current-desc" id="forecastCurrentDesc">Carregando...</div>
        <div class="forecast-current-details" id="forecastCurrentDetails"></div>
      </div>

      <div class="forecast-last-updated">
        <span>ð Ãltima atualizaÃ§Ã£o:</span>
        <span id="forecastLastUpdated">--</span>
      </div>

      <section class="hourly-forecast-section" aria-label="PrevisÃ£o por hora das prÃ³ximas 12 horas">
        <div class="hourly-forecast-header">
          <h4 class="hourly-forecast-title">â±ï¸ PrÃ³ximas 12 horas</h4>
          <div class="hourly-forecast-actions">
            <button class="hourly-nav-btn" type="button" id="hourlyPrevBtn" aria-label="Voltar no carrossel">â¹</button>
            <button class="hourly-nav-btn" type="button" id="hourlyNextBtn" aria-label="AvanÃ§ar no carrossel">âº</button>
          </div>
        </div>

        <div class="hourly-carousel" id="hourlyCarousel" tabindex="0"></div>
        <div class="hourly-hint">Arraste horizontalmente ou use as setas.</div>
      </section>

      <div class="forecast-grid" id="forecastGrid"></div>
      <div class="forecast-extra-info" id="forecastExtraInfo"></div>

      <button class="qrcode-close-btn" id="closeForecastModal">Fechar</button>
    </div>
  </div>

  <!-- Mobile Navigation Overlay -->
  <div class="mobile-overlay" id="mobileOverlay"></div>

  <!-- Mobile Navigation Menu -->
  <nav class="mobile-nav" id="mobileNav">
    <div class="mobile-nav-header">
      <h3 class="mobile-nav-title">Menu</h3>
      <button class="mobile-nav-close" id="mobileNavClose">â</button>
    </div>

    <div class="mobile-nav-item" id="mobileThemeSelector">
      <div style="display: flex; align-items: center; gap: 0.75rem;">
        <span style="font-size: 1.3rem;">ð¨</span>
        <div style="flex: 1;">
          <div style="font-weight: 700; font-size: 0.95rem; color: var(--ml-text-primary);">Tema Visual</div>
          <div style="font-size: 0.75rem; color: var(--ml-text-tertiary);" id="mobileCurrentTheme">Claro</div>
        </div>
      </div>
    </div>

    <div class="mobile-nav-item" id="mobileUserInfo">
      <div style="display: flex; align-items: center; gap: 0.75rem;">
        <div class="user-avatar" id="mobileUserAvatar" style="width: 40px; height: 40px; font-size: 1.1rem;">?</div>
        <div>
          <div style="font-weight: 700; font-size: 0.95rem; color: var(--ml-text-primary);" id="mobileUserName">UsuÃ¡rio</div>
          <div style="font-size: 0.75rem; color: var(--ml-text-tertiary);" id="mobileUserRole">IS-FIELD Team</div>
        </div>
      </div>
    </div>

    <div class="mobile-nav-item" id="enableNotificationsBtn">
      <div style="display:flex; align-items:center; gap:.75rem;">
        <span style="font-size: 1.3rem;">ð</span>
        <div>
          <div style="font-weight:700; font-size:.95rem;">Ativar NotificaÃ§Ãµes</div>
          <div style="font-size:.75rem; color: var(--ml-text-tertiary);">Permitir alertas de lembretes</div>
        </div>
      </div>
    </div>

    <div class="mobile-nav-item" id="mobileWeather">
      <div style="display: flex; align-items: center; gap: 0.75rem;">
        <span style="font-size: 1.5rem;" id="mobileWeatherIcon">â³</span>
        <div style="flex: 1;">
          <div style="font-weight: 700; font-size: 0.95rem; color: var(--ml-text-primary);" id="mobileWeatherTemp">Carregando...</div>
          <div style="font-size: 0.75rem; color: var(--ml-text-tertiary);" id="mobileWeatherLocation">--</div>
          <div style="font-size: 0.7rem; color: var(--ml-blue); font-weight: 600; margin-top: 2px;" id="mobileWeatherDesc">--</div>
        </div>
      </div>
    </div>

    <div class="mobile-nav-item" id="mobileNotesBtn">
      <div style="display: flex; align-items: center; gap: 0.75rem;">
        <span style="font-size: 1.3rem;">ð</span>
        <div>
          <div style="font-weight: 700; font-size: 0.95rem; color: var(--ml-text-primary);">Notas RÃ¡pidas</div>
          <div style="font-size: 0.75rem; color: var(--ml-text-tertiary);" id="mobileNotesCount">0 notas</div>
        </div>
      </div>
    </div>

    <div class="mobile-nav-item" id="mobileRemindersBtn">
      <div style="display: flex; align-items: center; gap: 0.75rem;">
        <span style="font-size: 1.3rem;">ð</span>
        <div>
          <div style="font-weight: 700; font-size: 0.95rem; color: var(--ml-text-primary);">Lembretes</div>
          <div style="font-size: 0.75rem; color: var(--ml-text-tertiary);" id="mobileRemindersCount">0 ativos</div>
        </div>
      </div>
    </div>

    <div class="mobile-nav-item" id="mobilePresentationMode">
      <div style="display: flex; align-items: center; gap: 0.75rem;">
        <span style="font-size: 1.3rem;">ð¥ï¸</span>
        <div>
          <div style="font-weight: 700; font-size: 0.95rem; color: var(--ml-text-primary);">Modo ApresentaÃ§Ã£o</div>
          <div style="font-size: 0.75rem; color: var(--ml-text-tertiary);">Tela cheia para demos</div>
        </div>
      </div>
    </div>

    <div class="mobile-nav-item" style="background: var(--ml-success-bg); border-color: var(--ml-green);">
      <div style="display: flex; align-items: center; gap: 0.75rem;">
        <span class="status-dot"></span>
        <div>
          <div style="font-weight: 700; font-size: 0.95rem; color: var(--ml-green-dark);">Status</div>
          <div style="font-size: 0.75rem; color: var(--ml-green-dark);" id="mobileConnectionStatus">Online</div>
        </div>
      </div>
    </div>
  </nav>

  <!-- Corporate Header -->
  <header class="corporate-header">
    <div class="header-container">
      <div class="brand-section">
        <div class="brand-logo">
          <img src="https://i.imgur.com/U0qdo1j.png" alt="Mercado Livre Logo" loading="lazy">
        </div>
        <div class="brand-info">
          <div class="brand-title">IS Tools Portal</div>
          <div class="brand-subtitle">MERCADO LIVRE</div>
        </div>
      </div>

      <div class="header-actions">
        <button class="hamburger-menu" id="hamburgerMenu" aria-label="Abrir menu">â°</button>

        <div class="connection-status" id="connectionStatus">
          <span class="status-dot"></span>
          <span class="status-text">Online</span>
        </div>

        <div class="weather-widget" id="weatherWidget" title="Clique para ver a previsÃ£o completa de 7 dias">
          <div class="weather-icon" id="weatherIcon">â³</div>
          <div class="weather-info">
            <div class="weather-temp" id="weatherTemp">
              <span>Carregando...</span>
              <span class="weather-feels-like" id="weatherFeelsLike"></span>
            </div>
            <div class="weather-location" id="weatherLocation" title="Clique para alterar a cidade">
              <span>ð</span>
              <span>--</span>
            </div>
            <div class="weather-description" id="weatherDescription">--</div>
            <div class="weather-details-mini" id="weatherDetailsMini"></div>
          </div>
        </div>

        <div class="theme-selector">
          <button class="theme-toggle" id="themeToggle" aria-label="Alternar tema" title="Selecionar tema">
            <span class="theme-icon">ð</span>
          </button>
          <div class="theme-dropdown" id="themeDropdown">
            <div class="theme-option" data-theme="light">
              <div class="theme-preview">
                <div class="theme-preview-split" style="background: #FFFFFF;"></div>
                <div class="theme-preview-split" style="background: #FFE600;"></div>
              </div>
              <span class="theme-option-label">Claro</span>
            </div>
            <div class="theme-option" data-theme="dark">
              <div class="theme-preview">
                <div class="theme-preview-split" style="background: #1A1A1A;"></div>
                <div class="theme-preview-split" style="background: #FFE600;"></div>
              </div>
              <span class="theme-option-label">Escuro</span>
            </div>
            <div class="theme-option" data-theme="highContrast">
              <div class="theme-preview">
                <div class="theme-preview-split" style="background: #000000;"></div>
                <div class="theme-preview-split" style="background: #FFFF00;"></div>
              </div>
              <span class="theme-option-label">Alto Contraste</span>
            </div>
            <div class="theme-option" data-theme="meliClassic">
              <div class="theme-preview">
                <div class="theme-preview-split" style="background: #FFEB3B;"></div>
                <div class="theme-preview-split" style="background: #2962FF;"></div>
              </div>
              <span class="theme-option-label">Meli Classic</span>
            </div>
          </div>
        </div>

        <button class="presentation-btn" id="presentationBtn" aria-label="Modo apresentaÃ§Ã£o" title="Ativar modo apresentaÃ§Ã£o (F11)">ð¥ï¸</button>

        <div class="header-badge">
          <span>â¡</span>
          <span>Acesso RÃ¡pido</span>
        </div>

        <div class="user-info" id="userInfo" title="Clique para editar perfil">
          <div class="user-avatar" id="userAvatar">?</div>
          <div class="user-details">
            <div class="user-name" id="userName">Carregando...</div>
            <div class="user-role">IS-FIELD Team</div>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- Breadcrumb -->
  <div class="breadcrumb-section">
    <div class="breadcrumb-container">
      <nav class="breadcrumb" aria-label="NavegaÃ§Ã£o estrutural">
        <div class="breadcrumb-item">
          <a href="#" class="breadcrumb-link">Home</a>
          <span class="breadcrumb-separator">âº</span>
        </div>
        <div class="breadcrumb-item">
          <a href="#" class="breadcrumb-link">Ferramentas</a>
          <span class="breadcrumb-separator">âº</span>
        </div>
        <div class="breadcrumb-item">
          <span>Portal IS-FIELD</span>
        </div>
      </nav>
    </div>
  </div>

  <!-- Hero Section -->
  <section class="hero-section" id="heroSection">
    <div class="particles">
      <span style="--i:1"></span>
      <span style="--i:2"></span>
      <span style="--i:3"></span>
      <span style="--i:4"></span>
      <span style="--i:5"></span>
      <span style="--i:6"></span>
    </div>

    <div class="hero-container" id="heroContainer">
      <div class="hero-top">
        <div class="hero-label">
          <span>â¡</span>
          <span>Plataforma IS-FIELD</span>
        </div>
        <div class="hero-time" id="heroTime">
          <span>ð</span>
          <span id="currentTime">--:--</span>
        </div>
      </div>
      <h1 class="hero-title">Bem-vindo, <span id="heroUserName">UsuÃ¡rio</span>!</h1>
      <p class="hero-description">
        Acesso centralizado e otimizado a links corporativos, sistemas internos e recursos essenciais para maximizar a produtividade da equipe IS-FIELD do Mercado Livre.
      </p>
    </div>
  </section>

  <!-- Main Container -->
  <main class="main-container">

    <!-- Stats Dashboard -->
    <section class="stats-dashboard" aria-label="Dashboard de estatÃ­sticas">
      <div class="stat-card">
        <div class="stat-header">
          <div class="stat-icon-box">ð</div>
          <div class="stat-trend"><span>â</span><span>12%</span></div>
        </div>
        <div class="stat-value" id="linkCount">0</div>
        <div class="stat-label">Links DisponÃ­veis</div>
      </div>

      <div class="stat-card">
        <div class="stat-header">
          <div class="stat-icon-box">ð</div>
          <div class="stat-trend"><span>â</span><span>8%</span></div>
        </div>
        <div class="stat-value" id="textCount">0</div>
        <div class="stat-label">Templates de Texto</div>
      </div>

      <div class="stat-card">
        <div class="stat-header">
          <div class="stat-icon-box">â¡</div>
          <div class="stat-trend"><span>â</span><span>24%</span></div>
        </div>
        <div class="stat-value" id="copyCount">0</div>
        <div class="stat-label">OperaÃ§Ãµes Realizadas</div>
      </div>

      <div class="stat-card">
        <div class="stat-header">
          <div class="stat-icon-box">ð</div>
          <div class="stat-trend"><span>â</span><span>5%</span></div>
        </div>
        <div class="stat-value" id="historyCount">0</div>
        <div class="stat-label">Links Acessados</div>
      </div>

      <div class="stat-card">
        <div class="stat-header">
          <div class="stat-icon-box">ð</div>
          <div class="stat-trend"><span>â</span><span>3%</span></div>
        </div>
        <div class="stat-value" id="notesCount">0</div>
        <div class="stat-label">Notas Criadas</div>
      </div>
    </section>

    <!-- Dica do Dia -->
    <section class="tip-card" id="tipOfTheDayCard">
      <div class="tip-icon">ð¡</div>
      <div class="tip-content">
        <h3 class="tip-title" id="tipTitle">Dica do Dia</h3>
        <p class="tip-text" id="tipText">Carregando dica...</p>
      </div>
    </section>

    <!-- Lembretes -->
    <section class="reminders-card" id="remindersCard">
      <div class="reminders-header">
        <h3 class="reminders-title"><span>ð</span> Lembretes Ativos</h3>
        <button class="add-reminder-btn" id="addReminderBtn"><span>+</span><span>Novo Lembrete</span></button>
      </div>
      <div class="reminders-list" id="remindersList">
        <div class="reminders-empty">Nenhum lembrete configurado</div>
      </div>
    </section>

    <!-- Notas -->
    <section class="notes-card" id="notesCard">
      <div class="notes-header">
        <h3 class="notes-title"><span>ð</span> Notas RÃ¡pidas</h3>
        <button class="add-note-btn" id="addNoteBtn"><span>+</span><span>Nova Nota</span></button>
      </div>
      <div class="notes-grid" id="notesGrid">
        <div class="notes-empty">Clique em "+ Nova Nota" para comeÃ§ar</div>
      </div>
    </section>

    <!-- HistÃ³rico -->
    <section class="history-card" id="historyCard" style="display: none;">
      <div class="history-header">
        <h3 class="history-title"><span>ð</span> Acessados Recentemente</h3>
        <button class="clear-history-btn" id="clearHistoryBtn" title="Limpar histÃ³rico">ðï¸ Limpar</button>
      </div>
      <div class="history-list" id="historyList">
        <div class="history-empty">Nenhum link acessado ainda</div>
      </div>
    </section>

    <!-- Search -->
    <section class="search-section">
      <div class="search-header">
        <h2 class="search-title">Pesquisa Inteligente</h2>
        <p class="search-subtitle">Encontre links, templates e recursos corporativos instantaneamente</p>
      </div>
      <div class="search-wrapper">
        <div class="search-input-container">
          <span class="search-icon">ð</span>
          <label for="searchInput" class="sr-only">Campo de pesquisa</label>
          <input type="text" id="searchInput" class="search-bar" placeholder="Digite para pesquisar: links, sistemas, textos, recursos..." autocomplete="off" aria-label="Pesquisar recursos">
          <button id="clearSearchBtn" class="clear-search-btn" aria-label="Limpar pesquisa">â</button>
        </div>

        <div class="search-suggestions hidden" id="searchSuggestions"></div>

        <div class="keyboard-hint">
          <span>Pressione</span><kbd>Ctrl</kbd><span>+</span><kbd>K</kbd><span>para pesquisar rapidamente</span>
        </div>
      </div>
      <div id="searchStatus" class="search-status hidden" role="status" aria-live="polite"></div>
    </section>

    <div id="contentContainer">
      <div class="skeleton-card"></div>
      <div class="skeleton-card" style="margin-top: 1.25rem;"></div>
      <div class="skeleton-card" style="margin-top: 1.25rem;"></div>
    </div>
  </main>

  <!-- Footer -->
  <footer class="corporate-footer">
    <div class="footer-container">
      <div class="footer-copyright">
        Â© 2024 Mercado Livre S.A. | IS-FIELD Division | Todos os direitos reservados
      </div>
      <div class="footer-badges">
        <span class="footer-badge">ð Seguro</span>
        <span class="footer-badge">â¡ Alta Performance</span>
        <span class="footer-badge">ð± Responsivo</span>
        <span class="footer-badge">â¿ AcessÃ­vel</span>
      </div>
    </div>
  </footer>

  <button class="scroll-top-btn" id="scrollTopBtn" aria-label="Voltar ao topo da pÃ¡gina">â</button>
  <div class="tooltip" id="tooltip" role="alert"></div>
  <audio id="bip-audio" src="https://cdn.pixabay.com/audio/2022/03/15/audio_1120b53a82.mp3" preload="auto" aria-hidden="true"></audio>

  <noscript>
    â ï¸ ATENÃÃO: Este portal corporativo requer JavaScript habilitado.
  </noscript>
  <script>
    document.addEventListener('DOMContentLoaded', () => {

      // =========================================================
      // ===== UTIL: BEEP + CLIPBOARD FALLBACK (file:// Chrome) ===
      // =========================================================
      const audioBip = document.getElementById('bip-audio');

      const beep = () => {
        try {
          audioBip.currentTime = 0;
          audioBip.play().catch(() => {});
        } catch {}
      };

      async function copyToClipboard(text) {
        try {
          if (navigator.clipboard && window.isSecureContext) {
            await navigator.clipboard.writeText(text);
            return true;
          }
        } catch {}

        try {
          const ta = document.createElement('textarea');
          ta.value = text;
          ta.style.position = 'fixed';
          ta.style.left = '-9999px';
          ta.style.top = '-9999px';
          document.body.appendChild(ta);
          ta.focus();
          ta.select();
          const ok = document.execCommand('copy');
          ta.remove();
          return ok;
        } catch {
          return false;
        }
      }

      // =========================================================
      // ===== NOTIFICAÃÃO ÃNICA (toast + Notification) ==========
      // =========================================================
      function showNotification(message, options = {}) {
        // Toast sempre
        const tooltip = document.getElementById('tooltip');
        if (tooltip) {
          tooltip.textContent = message;
          tooltip.style.left = '50%';
          tooltip.style.top = '100px';
          tooltip.style.animation = 'none';
          requestAnimationFrame(() => {
            tooltip.style.animation = 'tooltipShow 3s ease-in-out forwards';
          });
        }

        // Notification do SO (pode falhar em file://)
        try {
          if ('Notification' in window && Notification.permission === 'granted') {
            new Notification('IS Tools Portal | Mercado Livre', {
              body: message,
              icon: 'https://i.imgur.com/U0qdo1j.png',
              badge: 'https://i.imgur.com/U0qdo1j.png',
              ...options
            });
          }
        } catch {}
      }

      async function requestNotificationsWithGesture() {
        if (!('Notification' in window)) {
          showNotification('â Seu navegador nÃ£o suporta notificaÃ§Ãµes.');
          return;
        }

        if (Notification.permission === 'granted') {
          showNotification('ð NotificaÃ§Ãµes jÃ¡ estÃ£o ativadas!');
          return;
        }

        if (Notification.permission === 'denied') {
          showNotification('â ï¸ NotificaÃ§Ãµes bloqueadas. Habilite nas configuraÃ§Ãµes do Chrome.');
          return;
        }

        try {
          const permission = await Notification.requestPermission();
          localStorage.setItem('notificationRequested', 'true');

          if (permission === 'granted') {
            showNotification('â NotificaÃ§Ãµes ativadas! VocÃª receberÃ¡ alertas dos lembretes.');
            beep();
          } else {
            showNotification('â¹ï¸ VocÃª optou por nÃ£o ativar notificaÃ§Ãµes.');
          }
        } catch {
          showNotification('â Falha ao solicitar permissÃ£o de notificaÃ§Ã£o.');
        }
      }

      document.getElementById('enableNotificationsBtn')?.addEventListener('click', () => {
        requestNotificationsWithGesture();
      });

      // =========================================================
      // ===== MODAIS A11Y: focus trap + retorno de foco =========
      // =========================================================
      let lastFocusedElement = null;

      function getFocusableElements(container) {
        return Array.from(container.querySelectorAll(
          'a[href], button:not([disabled]), textarea, input, select, [tabindex]:not([tabindex="-1"])'
        ));
      }

      function trapFocus(modalEl) {
        function handleKeyDown(e) {
          if (e.key !== 'Tab') return;
          const focusables = getFocusableElements(modalEl);
          if (!focusables.length) return;

          const first = focusables[0];
          const last = focusables[focusables.length - 1];

          if (e.shiftKey && document.activeElement === first) {
            e.preventDefault();
            last.focus();
          } else if (!e.shiftKey && document.activeElement === last) {
            e.preventDefault();
            first.focus();
          }
        }
        modalEl._trapHandler = handleKeyDown;
        modalEl.addEventListener('keydown', handleKeyDown);
      }

      function releaseFocusTrap(modalEl) {
        if (modalEl?._trapHandler) {
          modalEl.removeEventListener('keydown', modalEl._trapHandler);
          delete modalEl._trapHandler;
        }
      }

      function openModal(modalEl, { initialFocusSelector } = {}) {
        if (!modalEl) return;
        lastFocusedElement = document.activeElement;

        modalEl.classList.add('active');
        document.body.style.overflow = 'hidden';

        trapFocus(modalEl);

        const toFocus = initialFocusSelector
          ? modalEl.querySelector(initialFocusSelector)
          : getFocusableElements(modalEl)[0];

        setTimeout(() => toFocus?.focus?.(), 0);
      }

      function closeModal(modalEl) {
        if (!modalEl) return;

        modalEl.classList.remove('active');
        document.body.style.overflow = '';

        releaseFocusTrap(modalEl);
        setTimeout(() => lastFocusedElement?.focus?.(), 0);
      }

      // =========================================================
      // ===== THEME SYSTEM (mantido) =============================
      // =========================================================
      const themeToggle = document.getElementById('themeToggle');
      const themeDropdown = document.getElementById('themeDropdown');
      const root = document.documentElement;
      const themeIcon = themeToggle.querySelector('.theme-icon');
      const mobileCurrentTheme = document.getElementById('mobileCurrentTheme');

      const themeIcons = { light: 'âï¸', dark: 'ð', highContrast: 'â«', meliClassic: 'ð' };
      const themeNames = { light: 'Claro', dark: 'Escuro', highContrast: 'Alto Contraste', meliClassic: 'Meli Classic' };

      let currentTheme = localStorage.getItem('theme') || 'light';
      root.setAttribute('data-theme', currentTheme);
      themeIcon.textContent = themeIcons[currentTheme];
      if (mobileCurrentTheme) mobileCurrentTheme.textContent = themeNames[currentTheme];

      function updateThemeOptions() {
        document.querySelectorAll('.theme-option').forEach(option => {
          option.classList.toggle('active', option.dataset.theme === currentTheme);
        });
      }
      updateThemeOptions();

      themeToggle.addEventListener('click', (e) => {
        e.stopPropagation();
        themeDropdown.classList.toggle('active');
      });

      document.addEventListener('click', (e) => {
        if (!themeToggle.contains(e.target) && !themeDropdown.contains(e.target)) {
          themeDropdown.classList.remove('active');
        }
      });

      document.querySelectorAll('.theme-option').forEach(option => {
        option.addEventListener('click', () => {
          currentTheme = option.dataset.theme;
          root.setAttribute('data-theme', currentTheme);
          localStorage.setItem('theme', currentTheme);
          themeIcon.textContent = themeIcons[currentTheme];
          if (mobileCurrentTheme) mobileCurrentTheme.textContent = themeNames[currentTheme];
          updateThemeOptions();
          themeDropdown.classList.remove('active');
          showNotification(`ð¨ Tema "${themeNames[currentTheme]}" ativado!`);
        });
      });

      document.getElementById('mobileThemeSelector')?.addEventListener('click', () => {
        const themes = ['light', 'dark', 'highContrast', 'meliClassic'];
        const idx = themes.indexOf(currentTheme);
        currentTheme = themes[(idx + 1) % themes.length];
        root.setAttribute('data-theme', currentTheme);
        localStorage.setItem('theme', currentTheme);
        if (mobileCurrentTheme) mobileCurrentTheme.textContent = themeNames[currentTheme];
        showNotification(`ð¨ Tema "${themeNames[currentTheme]}" ativado!`);
      });

      // =========================================================
      // ===== MOBILE MENU (toggle) ===============================
      // =========================================================
      const hamburgerMenu = document.getElementById('hamburgerMenu');
      const mobileNav = document.getElementById('mobileNav');
      const mobileOverlay = document.getElementById('mobileOverlay');
      const mobileNavClose = document.getElementById('mobileNavClose');

      function openMobileMenu() {
        mobileNav.classList.add('active');
        mobileOverlay.classList.add('active');
        hamburgerMenu.classList.add('active');
        document.body.style.overflow = 'hidden';
      }

      function closeMobileMenu() {
        mobileNav.classList.remove('active');
        mobileOverlay.classList.remove('active');
        hamburgerMenu.classList.remove('active');
        document.body.style.overflow = '';
      }

      hamburgerMenu?.addEventListener('click', () => {
        if (mobileNav.classList.contains('active')) closeMobileMenu();
        else openMobileMenu();
      });

      mobileNavClose?.addEventListener('click', closeMobileMenu);
      mobileOverlay?.addEventListener('click', closeMobileMenu);

      let touchStartX = 0;
      mobileNav?.addEventListener('touchstart', e => touchStartX = e.touches[0].clientX);
      mobileNav?.addEventListener('touchend', e => {
        const diff = e.changedTouches[0].clientX - touchStartX;
        if (diff > 100) closeMobileMenu();
      });

      // =========================================================
      // ===== CONNECTION STATUS =================================
      // =========================================================
      const connectionStatus = document.getElementById('connectionStatus');
      const statusDot = connectionStatus?.querySelector('.status-dot');
      const statusText = connectionStatus?.querySelector('.status-text');
      const mobileConnectionStatus = document.getElementById('mobileConnectionStatus');

      function updateConnectionStatus(isOnline) {
        if (!connectionStatus) return;
        if (isOnline) {
          connectionStatus.style.background = 'var(--ml-success-bg)';
          connectionStatus.style.borderColor = 'rgba(0, 166, 80, 0.2)';
          statusDot.style.background = 'var(--ml-green)';
          statusDot.style.boxShadow = '0 0 10px var(--ml-green)';
          statusText.textContent = 'Online';
          statusText.style.color = 'var(--ml-green-dark)';
          if (mobileConnectionStatus) mobileConnectionStatus.textContent = 'Online';
        } else {
          connectionStatus.style.background = '#ffe0e0';
          connectionStatus.style.borderColor = 'rgba(230, 0, 35, 0.2)';
          statusDot.style.background = 'var(--ml-red)';
          statusDot.style.boxShadow = '0 0 10px var(--ml-red)';
          statusText.textContent = 'Offline';
          statusText.style.color = 'var(--ml-red)';
          if (mobileConnectionStatus) mobileConnectionStatus.textContent = 'Offline';
        }
      }

      window.addEventListener('online', () => updateConnectionStatus(true));
      window.addEventListener('offline', () => updateConnectionStatus(false));
      updateConnectionStatus(navigator.onLine);

      // =========================================================
      // ===== PRESENTATION MODE =================================
      // =========================================================
      const presentationBtn = document.getElementById('presentationBtn');
      const mobilePresentationMode = document.getElementById('mobilePresentationMode');

      function togglePresentationMode() {
        if (!document.fullscreenElement) {
          document.documentElement.requestFullscreen().then(() => {
            document.body.classList.add('presentation-mode');
          }).catch(() => {
            document.body.classList.toggle('presentation-mode');
          });
        } else {
          document.exitFullscreen();
          document.body.classList.remove('presentation-mode');
        }
      }

      presentationBtn?.addEventListener('click', togglePresentationMode);
      mobilePresentationMode?.addEventListener('click', () => {
        closeMobileMenu();
        togglePresentationMode();
      });

      document.addEventListener('fullscreenchange', () => {
        if (!document.fullscreenElement) document.body.classList.remove('presentation-mode');
      });

      // =========================================================
      // ===== USER PROFILE (com T4) ==============================
      // =========================================================
      let userProfile = {
        name: 'UsuÃ¡rio',
        shift: '',
        shiftTime: '',
        shiftName: '',
        workDays: [],
        workDaysNames: []
      };

      const shiftData = {
        'T1': { name: 'T1 - ManhÃ£', time: '05:30 Ã s 14:30' },
        'T4': { name: 'T4 - Comercial', time: '08:30 Ã s 17:30' },
        'T2': { name: 'T2 - Tarde', time: '13:00 Ã s 22:00' },
        'T3': { name: 'T3 - Noite', time: '22:00 Ã s 07:00' }
      };

      const weekdayNamesLong = {
        0: 'Domingo',
        1: 'Segunda-feira',
        2: 'TerÃ§a-feira',
        3: 'Quarta-feira',
        4: 'Quinta-feira',
        5: 'Sexta-feira',
        6: 'SÃ¡bado'
      };

      function loadUserProfile() {
        const saved = localStorage.getItem('userProfile');
        if (saved) {
          userProfile = JSON.parse(saved);
          return true;
        }
        return false;
      }

      function saveUserProfile() {
        localStorage.setItem('userProfile', JSON.stringify(userProfile));
      }

      function updateUserUI() {
        const name = userProfile.name || 'UsuÃ¡rio';
        const userInitials = name.split(' ').map(n => n[0]).join('').toUpperCase().substring(0, 2);

        document.getElementById('userName').textContent = name;
        document.getElementById('heroUserName').textContent = name;
        document.getElementById('userAvatar').textContent = userInitials;

        const mobileUserName = document.getElementById('mobileUserName');
        const mobileUserAvatar = document.getElementById('mobileUserAvatar');
        const mobileUserRole = document.getElementById('mobileUserRole');

        if (mobileUserName) mobileUserName.textContent = name;
        if (mobileUserAvatar) mobileUserAvatar.textContent = userInitials;

        document.querySelectorAll('.user-role').forEach(el => {
          if (userProfile.shift && userProfile.shiftTime) el.textContent = `${userProfile.shift} | ${userProfile.shiftTime}`;
          else el.textContent = 'IS-FIELD Team';
        });

        if (mobileUserRole) {
          if (userProfile.shift && userProfile.shiftTime) mobileUserRole.textContent = `${userProfile.shift} | ${userProfile.shiftTime}`;
          else mobileUserRole.textContent = 'IS-FIELD Team';
        }
      }

      function openProfileConfig() {
        const modal = document.getElementById('profileConfigModal');
        document.getElementById('profileConfigForm')?.reset();

        document.getElementById('profileName').value = userProfile.name || '';

        if (userProfile.shift) {
          const radio = document.getElementById(`shift-${userProfile.shift.toLowerCase()}`);
          if (radio) radio.checked = true;
        }

        (userProfile.workDays || []).forEach(day => {
          const checkbox = document.getElementById(`day-${day}`);
          if (checkbox) checkbox.checked = true;
        });

        openModal(modal, { initialFocusSelector: '#profileName' });
      }

      function closeProfileConfig() {
        closeModal(document.getElementById('profileConfigModal'));
      }

      function initializeUser() {
        const hasProfile = loadUserProfile();
        if (!hasProfile) setTimeout(() => openProfileConfig(), 1500);
        else updateUserUI();
      }

      document.getElementById('profileConfigForm')?.addEventListener('submit', (e) => {
        e.preventDefault();

        const name = document.getElementById('profileName').value.trim();
        const shift = document.querySelector('input[name="shift"]:checked')?.value;
        const workDays = Array.from(document.querySelectorAll('input[name="workDays"]:checked')).map(cb => parseInt(cb.value, 10));

        if (!name) { alert('â ï¸ Por favor, digite seu nome!'); return; }
        if (!shift) { alert('â ï¸ Por favor, selecione seu turno de trabalho!'); return; }
        if (workDays.length === 0) { alert('â ï¸ Por favor, selecione pelo menos um dia da semana!'); return; }

        userProfile = {
          name,
          shift,
          shiftTime: shiftData[shift].time,
          shiftName: shiftData[shift].name,
          workDays: workDays.sort((a, b) => a - b),
          workDaysNames: workDays.map(d => weekdayNamesLong[d])
        };

        saveUserProfile();
        updateUserUI();
        closeProfileConfig();

        // populateContent Ã© definido na parte 4
        if (typeof populateContent === 'function') populateContent();

        showNotification(`â Perfil configurado!\nð¤ ${name}\nð ${shiftData[shift].name}\nð ${userProfile.workDaysNames.join(', ')}`);
        beep();
      });

      document.getElementById('profileCancelBtn')?.addEventListener('click', () => {
        if (!userProfile.shift) {
          userProfile = {
            name: 'Colaborador',
            shift: 'T2',
            shiftTime: '13:00 Ã s 22:00',
            shiftName: 'T2 - Tarde',
            workDays: [1,2,3,4,5],
            workDaysNames: ['Segunda-feira','TerÃ§a-feira','Quarta-feira','Quinta-feira','Sexta-feira']
          };
          saveUserProfile();
          updateUserUI();
        }
        closeProfileConfig();
      });

      document.getElementById('userInfo')?.addEventListener('click', openProfileConfig);
      document.getElementById('mobileUserInfo')?.addEventListener('click', () => { closeMobileMenu(); openProfileConfig(); });

      document.getElementById('profileConfigModal')?.addEventListener('click', (e) => {
        if (e.target === e.currentTarget) {
          if (userProfile.shift) closeProfileConfig();
        }
      });

      initializeUser();

      // =========================================================
      // ===== CLOCK =============================================
      // =========================================================
      function updateClock() {
        const now = new Date();
        const h = String(now.getHours()).padStart(2, '0');
        const m = String(now.getMinutes()).padStart(2, '0');
        const s = String(now.getSeconds()).padStart(2, '0');
        document.getElementById('currentTime').textContent = `${h}:${m}:${s}`;
      }
      updateClock();
      setInterval(updateClock, 1000);

      // =========================================================
      // ===== PARALLAX ==========================================
      // =========================================================
      const heroContainer = document.getElementById('heroContainer');
      window.addEventListener('scroll', () => {
        const scrolled = window.scrollY;
        if (heroContainer && scrolled < 600) {
          heroContainer.style.transform = `translateY(${scrolled * 0.3}px)`;
        }
      }, { passive: true });

      // =========================================================
      // ===== QR MODAL (openModal/closeModal) ===================
      // =========================================================
      let currentQRCode = null;

      function openQRCodeModal(url, title) {
        const modal = document.getElementById('qrcodeModal');
        const container = document.getElementById('qrcodeContainer');
        container.innerHTML = '';
        currentQRCode = new QRCode(container, {
          text: url,
          width: 256,
          height: 256,
          colorDark: "#2D3277",
          colorLight: "#FFFFFF",
          correctLevel: QRCode.CorrectLevel.H
        });
        document.getElementById('qrcodeTitle').textContent = title;
        document.getElementById('qrcodeUrl').textContent = url;

        openModal(modal, { initialFocusSelector: '#qrcodeCloseBtn' });
      }

      document.getElementById('qrcodeCloseBtn')?.addEventListener('click', () => closeModal(document.getElementById('qrcodeModal')));
      document.getElementById('qrcodeModal')?.addEventListener('click', (e) => {
        if (e.target === e.currentTarget) closeModal(document.getElementById('qrcodeModal'));
      });

      // Expor para uso no handler de cards (parte 4)
      window.__openQRCodeModal = openQRCodeModal;

      // =========================================================
      // ===== WEATHER ULTRA ======================================
      // =========================================================
      const weatherWidget = document.getElementById('weatherWidget');
      const weatherIconEl = document.getElementById('weatherIcon');
      const weatherTempEl = document.getElementById('weatherTemp');
      const weatherFeelsLikeEl = document.getElementById('weatherFeelsLike');
      const weatherLocationEl = document.getElementById('weatherLocation');
      const weatherDescriptionEl = document.getElementById('weatherDescription');
      const weatherDetailsMiniEl = document.getElementById('weatherDetailsMini');

      const forecastModal = document.getElementById('forecastModal');
      const closeForecastModalBtn = document.getElementById('closeForecastModal');

      const forecastGridEl = document.getElementById('forecastGrid');
      const forecastModalLocationEl = document.getElementById('forecastModalLocation');
      const forecastCurrentIcon = document.getElementById('forecastCurrentIcon');
      const forecastCurrentTemp = document.getElementById('forecastCurrentTemp');
      const forecastCurrentDesc = document.getElementById('forecastCurrentDesc');
      const forecastCurrentDetails = document.getElementById('forecastCurrentDetails');
      const forecastExtraInfo = document.getElementById('forecastExtraInfo');
      const forecastLastUpdatedEl = document.getElementById('forecastLastUpdated');

      const hourlyCarouselEl = document.getElementById('hourlyCarousel');
      const hourlyPrevBtn = document.getElementById('hourlyPrevBtn');
      const hourlyNextBtn = document.getElementById('hourlyNextBtn');

      const mobileWeatherIcon = document.getElementById('mobileWeatherIcon');
      const mobileWeatherTemp = document.getElementById('mobileWeatherTemp');
      const mobileWeatherLocation = document.getElementById('mobileWeatherLocation');
      const mobileWeatherDesc = document.getElementById('mobileWeatherDesc');

      const weatherIcons = {
        0: 'âï¸', 1: 'ð¤ï¸', 2: 'â', 3: 'âï¸',
        45: 'ð«ï¸', 48: 'ð«ï¸',
        51: 'ð¦ï¸', 53: 'ð¦ï¸', 55: 'ð§ï¸',
        61: 'ð§ï¸', 63: 'ð§ï¸', 65: 'âï¸',
        71: 'ð¨ï¸', 73: 'ð¨ï¸', 75: 'âï¸', 77: 'ð¨ï¸',
        80: 'ð¦ï¸', 81: 'âï¸', 82: 'âï¸',
        85: 'ð¨ï¸', 86: 'âï¸',
        95: 'âï¸', 96: 'âï¸', 99: 'âï¸'
      };

      const weatherDescriptions = {
        0: 'CÃ©u Limpo', 1: 'Principalmente Limpo', 2: 'Parcialmente Nublado', 3: 'Nublado',
        45: 'Neblina', 48: 'Nevoeiro',
        51: 'Garoa Leve', 53: 'Garoa Moderada', 55: 'Garoa Intensa',
        61: 'Chuva Leve', 63: 'Chuva Moderada', 65: 'Chuva Forte',
        71: 'Neve Leve', 73: 'Neve Moderada', 75: 'Neve Intensa', 77: 'Neve Granular',
        80: 'Pancadas Leves', 81: 'Pancadas Moderadas', 82: 'Pancadas Fortes',
        85: 'Nevada Leve', 86: 'Nevada Forte',
        95: 'Tempestade', 96: 'Tempestade com Granizo Leve', 99: 'Tempestade com Granizo Forte'
      };

      function safeGet(arr, idx, fallback = null) {
        if (!Array.isArray(arr)) return fallback;
        return (idx >= 0 && idx < arr.length && arr[idx] != null) ? arr[idx] : fallback;
      }

      function findClosestHourlyIndex(timesISO) {
        if (!Array.isArray(timesISO) || timesISO.length === 0) return 0;
        const now = Date.now();
        let bestIdx = 0, bestDiff = Infinity;
        for (let i = 0; i < timesISO.length; i++) {
          const t = new Date(timesISO[i]).getTime();
          const diff = Math.abs(t - now);
          if (diff < bestDiff) { bestDiff = diff; bestIdx = i; }
        }
        return bestIdx;
      }

      function isDayNowFromDaily(dailyData) {
        try {
          const sunrise = new Date(dailyData.sunrise?.[0]).getTime();
          const sunset  = new Date(dailyData.sunset?.[0]).getTime();
          const now = Date.now();
          if (!Number.isFinite(sunrise) || !Number.isFinite(sunset)) return true;
          return now >= sunrise && now < sunset;
        } catch { return true; }
      }

      function getWeatherIconByDayNight(code, isDay) {
        if (!isDay && (code === 0 || code === 1)) return 'ð';
        if (!isDay && (code === 2 || code === 3)) return 'âï¸';
        return weatherIcons[code] || 'ð¡ï¸';
      }

      function getUVLevel(uv) {
        if (uv <= 2) return 'ð¢';
        if (uv <= 5) return 'ð¡';
        if (uv <= 7) return 'ð ';
        if (uv <= 10) return 'ð´';
        return 'ð£';
      }

      function renderHourlyCarousel12h(weatherData) {
        if (!hourlyCarouselEl) return;

        const times = weatherData.hourly?.time || [];
        const temps = weatherData.hourly?.temperature_2m || [];
        const winds = weatherData.hourly?.windspeed_10m || [];
        const precipProb = weatherData.hourly?.precipitation_probability || [];
        const codes = weatherData.hourly?.weathercode || [];

        if (!times.length) { hourlyCarouselEl.innerHTML = ''; return; }

        const startIdx = findClosestHourlyIndex(times);
        const endIdx = Math.min(startIdx + 12, times.length);

        let sunrise = null, sunset = null;
        try {
          sunrise = new Date(weatherData.daily?.sunrise?.[0]).getTime();
          sunset  = new Date(weatherData.daily?.sunset?.[0]).getTime();
        } catch {}

        const html = [];
        for (let i = startIdx; i < endIdx; i++) {
          const d = new Date(times[i]);
          const hour = d.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });

          const temp = Math.round(safeGet(temps, i, 0) || 0);
          const wind = Math.round(safeGet(winds, i, 0) || 0);
          const p = Math.round(safeGet(precipProb, i, 0) || 0);
          const code = safeGet(codes, i, null);

          const ts = d.getTime();
          const isDayHour = (Number.isFinite(sunrise) && Number.isFinite(sunset))
            ? (ts >= sunrise && ts < sunset)
            : true;

          const icon = (code != null) ? getWeatherIconByDayNight(code, isDayHour) : 'â³';

          html.push(`
            <article class="hourly-card" aria-label="PrevisÃ£o ${hour}">
              <div class="hourly-time">${hour}</div>
              <div class="hourly-icon">${icon}</div>
              <div class="hourly-temp">${temp}Â°</div>
              <div class="hourly-meta">
                <div class="hourly-rain"><span>â</span><span>${p}%</span></div>
                <div>ð¨ ${wind} km/h</div>
              </div>
            </article>
          `);
        }
        hourlyCarouselEl.innerHTML = html.join('');

        const scrollByCard = (dir = 1) => {
          const card = hourlyCarouselEl.querySelector('.hourly-card');
          const delta = card ? (card.getBoundingClientRect().width + 16) : 160;
          hourlyCarouselEl.scrollBy({ left: dir * delta * 2, behavior: 'smooth' });
        };

        hourlyPrevBtn?.addEventListener('click', () => scrollByCard(-1), { once: true });
        hourlyNextBtn?.addEventListener('click', () => scrollByCard(1), { once: true });

        hourlyCarouselEl.addEventListener('keydown', (e) => {
          if (e.key === 'ArrowLeft') { e.preventDefault(); scrollByCard(-1); }
          if (e.key === 'ArrowRight') { e.preventDefault(); scrollByCard(1); }
        }, { once: true });
      }

      async function getWeatherForCity(city) {
        try {
          const geocodingUrl = `https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(city)}&count=1&language=pt&format=json`;
          const geoRes = await fetch(geocodingUrl);
          if (!geoRes.ok) throw new Error(`HTTP ${geoRes.status} - ${geoRes.statusText}`);

          const geoData = await geoRes.json();
          if (geoData.results && geoData.results.length > 0) {
            const { latitude, longitude, name, country_code } = geoData.results[0];
            const displayName = `${name}, ${country_code}`;
            localStorage.setItem('weatherCity', JSON.stringify({ name: displayName, latitude, longitude }));
            fetchWeather(latitude, longitude, displayName);
          } else {
            alert('ð Cidade nÃ£o encontrada. Tente novamente.');
            showWeatherFallback();
          }
        } catch {
          alert('â Erro ao buscar a cidade. Verifique sua conexÃ£o.');
          showWeatherFallback();
        }
      }

      async function fetchWeather(lat, lon, locationName) {
        const weatherUrl =
          `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}` +
          `&current_weather=true` +
          `&daily=weathercode,temperature_2m_max,temperature_2m_min,windspeed_10m_max,precipitation_sum,precipitation_probability_max,uv_index_max,sunrise,sunset` +
          `&hourly=temperature_2m,relativehumidity_2m,apparent_temperature,visibility,windspeed_10m,precipitation_probability,weathercode` +
          `&timezone=auto`;

        try {
          const weatherRes = await fetch(weatherUrl);
          if (!weatherRes.ok) throw new Error(`HTTP ${weatherRes.status} - ${weatherRes.statusText}`);
          const weatherData = await weatherRes.json();

          // Ãºltima atualizaÃ§Ã£o
          if (forecastLastUpdatedEl) {
            const now = new Date();
            forecastLastUpdatedEl.textContent = `${now.toLocaleDateString('pt-BR')} ${now.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' })}`;
          }

          const temp = Math.round(weatherData.current_weather.temperature);
          const weatherCode = weatherData.current_weather.weathercode;
          const windSpeed = Math.round(weatherData.current_weather.windspeed);
          const description = weatherDescriptions[weatherCode] || 'Clima Atual';

          const isDay = isDayNowFromDaily(weatherData.daily);
          const icon = getWeatherIconByDayNight(weatherCode, isDay);

          const hourlyIdx = findClosestHourlyIndex(weatherData.hourly?.time);
          const currentHumidity = Math.round(safeGet(weatherData.hourly?.relativehumidity_2m, hourlyIdx, 0) || 0);
          const feelsLike = Math.round(safeGet(weatherData.hourly?.apparent_temperature, hourlyIdx, temp) || temp);
          const visibility = Math.round(((safeGet(weatherData.hourly?.visibility, hourlyIdx, 10000) || 10000) / 1000));
          const uvIndex = safeGet(weatherData.daily?.uv_index_max, 0, 0) || 0;

          // widget header
          weatherIconEl.textContent = icon;
          weatherTempEl.querySelector('span:first-child').textContent = `${temp}Â°C`;
          weatherFeelsLikeEl.textContent = `SensaÃ§Ã£o ${feelsLike}Â°`;
          weatherLocationEl.querySelector('span:last-child').textContent = locationName;
          weatherDescriptionEl.textContent = description;

          weatherDetailsMiniEl.innerHTML = `
            <div class="weather-detail-mini"><span>ð¨</span><span>${windSpeed}km/h</span></div>
            <div class="weather-detail-mini"><span>ð§</span><span>${currentHumidity}%</span></div>
          `;

          // mobile
          if (mobileWeatherIcon) mobileWeatherIcon.textContent = icon;
          if (mobileWeatherTemp) mobileWeatherTemp.textContent = `${temp}Â°C`;
          if (mobileWeatherLocation) mobileWeatherLocation.textContent = locationName;
          if (mobileWeatherDesc) mobileWeatherDesc.textContent = description;

          // modal current
          forecastCurrentIcon.textContent = icon;
          forecastCurrentTemp.textContent = `${temp}Â°C`;
          forecastCurrentDesc.textContent = description;

          const precipProb = safeGet(weatherData.daily?.precipitation_probability_max, 0, 0) || 0;
          const precipSum = Math.round(safeGet(weatherData.daily?.precipitation_sum, 0, 0) || 0);

          forecastCurrentDetails.innerHTML = `
            <div class="forecast-detail-item"><span>ð¨</span><span>Vento<br>${windSpeed} km/h</span></div>
            <div class="forecast-detail-item"><span>ð¡ï¸</span><span>SensaÃ§Ã£o<br>${feelsLike}Â°C</span></div>
            <div class="forecast-detail-item"><span>ð§</span><span>Umidade<br>${currentHumidity}%</span></div>
            <div class="forecast-detail-item"><span>â</span><span>Chuva<br>${precipProb}%</span></div>
            <div class="forecast-detail-item"><span>ðï¸</span><span>Visibilidade<br>${visibility} km</span></div>
            <div class="forecast-detail-item"><span>âï¸</span><span>UV Index<br>${Math.round(uvIndex)}</span></div>
          `;

          const sunrise = new Date(weatherData.daily.sunrise[0]).toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
          const sunset = new Date(weatherData.daily.sunset[0]).toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });

          forecastExtraInfo.innerHTML = `
            <div class="extra-info-card">
              <div class="extra-info-icon">ð</div>
              <div class="extra-info-label">Nascer do Sol</div>
              <div class="extra-info-value">${sunrise}</div>
            </div>
            <div class="extra-info-card">
              <div class="extra-info-icon">ð</div>
              <div class="extra-info-label">PÃ´r do Sol</div>
              <div class="extra-info-value">${sunset}</div>
            </div>
            <div class="extra-info-card">
              <div class="extra-info-icon">âï¸</div>
              <div class="extra-info-label">Ãndice UV</div>
              <div class="extra-info-value">${Math.round(uvIndex)} ${getUVLevel(uvIndex)}</div>
            </div>
            <div class="extra-info-card">
              <div class="extra-info-icon">ð§</div>
              <div class="extra-info-label">PrecipitaÃ§Ã£o Hoje</div>
              <div class="extra-info-value">${precipSum}mm</div>
            </div>
          `;

          // carrossel 12h
          renderHourlyCarousel12h(weatherData);

          // displayForecast Ã© definido na parte 4
          if (typeof displayForecast === 'function') displayForecast(weatherData.daily, locationName);

        } catch (err) {
          console.error('Weather fetch error:', err);
          showNotification(`â Erro ao atualizar clima: ${String(err.message || err)}`);
          showWeatherFallback();
          if (forecastLastUpdatedEl) forecastLastUpdatedEl.textContent = '--';
          if (hourlyCarouselEl) hourlyCarouselEl.innerHTML = '';
        }
      }

      function showWeatherFallback() {
        const hour = new Date().getHours();
        const icon = (hour >= 6 && hour < 12) ? 'ð' : (hour >= 12 && hour < 18) ? 'âï¸' : 'ð';
        const status = (hour >= 6 && hour < 12) ? 'Bom Dia' : (hour >= 12 && hour < 18) ? 'Boa Tarde' : 'Boa Noite';

        weatherIconEl.textContent = icon;
        weatherTempEl.querySelector('span:first-child').textContent = status;
        weatherFeelsLikeEl.textContent = '';
        weatherLocationEl.querySelector('span:last-child').textContent = 'Brasil';
        weatherDescriptionEl.textContent = 'Clima Local';
        weatherDetailsMiniEl.innerHTML = '';

        if (mobileWeatherIcon) mobileWeatherIcon.textContent = icon;
        if (mobileWeatherTemp) mobileWeatherTemp.textContent = status;
        if (mobileWeatherLocation) mobileWeatherLocation.textContent = 'Brasil';
        if (mobileWeatherDesc) mobileWeatherDesc.textContent = 'Clima Local';
      }

      function initializeWeather() {
        const savedCity = localStorage.getItem('weatherCity');
        if (savedCity) {
          const { latitude, longitude, name } = JSON.parse(savedCity);
          fetchWeather(latitude, longitude, name);
        } else {
          navigator.geolocation.getCurrentPosition(
            async (position) => {
              const { latitude: lat, longitude: lon } = position.coords;
              try {
                const geoUrl = `https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=${lat}&longitude=${lon}&localityLanguage=pt`;
                const geoRes = await fetch(geoUrl);
                if (!geoRes.ok) throw new Error(`HTTP ${geoRes.status}`);
                const geoData = await geoRes.json();
                const city = geoData.city || geoData.locality || 'Sua LocalizaÃ§Ã£o';
                const countryCode = geoData.countryCode || 'BR';
                fetchWeather(lat, lon, `${city}, ${countryCode}`);
              } catch {
                showWeatherFallback();
              }
            },
            () => showWeatherFallback()
          );
        }
      }

      function debounce(fn, wait = 650) {
        let t;
        return (...args) => {
          clearTimeout(t);
          t = setTimeout(() => fn(...args), wait);
        };
      }
      function normalizeCityInput(input) {
        return (input || '').trim().replace(/\s+/g, ' ');
      }
      function isValidCityName(v) {
        if (!v || v.length < 2 || v.length > 60) return false;
        if (/https?:\/\//i.test(v)) return false;
        if (!/^[\p{L}\p{N}\s\-\.'â]+$/u.test(v)) return false;
        return true;
      }

      const askCityDebounced = debounce(() => {
        const currentCity = weatherLocationEl.querySelector('span:last-child').textContent.split(',')[0].trim();
        const typed = prompt(
          'ð Digite o nome da cidade:\n\nExemplos: SÃ£o Paulo, Rio de Janeiro, Lisboa, Nova York',
          currentCity
        );

        const city = normalizeCityInput(typed);
        if (!city) return;

        if (!isValidCityName(city)) {
          showNotification('â ï¸ Nome de cidade invÃ¡lido. Ex: "SÃ£o Paulo" ou "Lisboa".');
          return;
        }

        if (city.toLowerCase() === currentCity.toLowerCase()) {
          showNotification('â¹ï¸ Cidade jÃ¡ selecionada.');
          return;
        }

        getWeatherForCity(city);
      }, 650);

      weatherLocationEl?.addEventListener('click', (e) => {
        e.stopPropagation();
        askCityDebounced();
      });

      // Forecast modal open/close a11y
      weatherWidget?.addEventListener('click', () => openModal(forecastModal, { initialFocusSelector: '#closeForecastModal' }));
      closeForecastModalBtn?.addEventListener('click', () => closeModal(forecastModal));
      forecastModal?.addEventListener('click', (e) => { if (e.target === forecastModal) closeModal(forecastModal); });

      document.getElementById('mobileWeather')?.addEventListener('click', () => {
        closeMobileMenu();
        openModal(forecastModal, { initialFocusSelector: '#closeForecastModal' });
      });

      forecastModal?.addEventListener('touchstart', e => touchStartX = e.touches[0].clientX);
      forecastModal?.addEventListener('touchend', e => {
        const diff = e.changedTouches[0].clientX - touchStartX;
        if (Math.abs(diff) > 100) closeModal(forecastModal);
      });

      initializeWeather();
      setInterval(initializeWeather, 15 * 60 * 1000);

      // =========================================================
      // ===== ESC global (fecha modais) ==========================
      // =========================================================
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
          closeModal(document.getElementById('qrcodeModal'));
          closeModal(document.getElementById('forecastModal'));
          closeMobileMenu();
          themeDropdown?.classList.remove('active');
          if (userProfile.shift) closeProfileConfig();
        }
      });

      // =========================================================
      // ===== Expor helpers necessÃ¡rios para Parte 4/5 ==========
      // =========================================================
      window.__app = {
        openModal, closeModal,
        openProfileConfig, closeProfileConfig,
        showNotification, copyToClipboard,
        beep,
        userProfile,
        getWeatherIconByDayNight,
        weatherIcons,
        weatherDescriptions,
        forecastGridEl,
        forecastModalLocationEl
      };
      // =========================================================
      // ===== DADOS (Links, Dicas) ==============================
      // =========================================================
      const linkCategories = [
        { categoryLabel: 'Acessos e SeguranÃ§a', icon: 'ð', items: [
          { label: 'CÃ³digo 8 DÃ­gitos', url: 'https://melihelp.adminml.com/auth0/35', icon: 'ð' },
          { label: 'SHIELD Gmail Internos', url: 'https://shield.adminml.com/requests/create?c=4276', icon: 'ð¡ï¸' },
          { label: 'MDM', url: 'https://cn259.awmdm.com/AirWatch/Login?ReturnUrl=%2FAirWatch%2F#/Device/Dashboard', icon: 'ð±' },
          { label: 'AD - Acesso RÃ¡pido', url: 'https://rds.local-is.net/RDWeb/WebClient/', icon: 'ð¥ï¸' }
        ]},
        { categoryLabel: 'Sistemas Internos', icon: 'âï¸', items: [
          { label: 'Jira IS-SP02', url: 'https://mercadolibre.atlassian.net/issues/?filter=77203', icon: 'ð' },
          { label: 'Mordor', url: 'https://melihelp-backoffice.adminml.com/home', icon: 'ð°' },
          { label: 'Backoffice Impressoras', url: 'https://shipping-bo.adminml.com/devices-ucs/home', icon: 'ð¨ï¸' },
          { label: 'Labeling WMS SKU', url: 'https://wms.adminml.com/labeling?inventory=FRAG82348', icon: 'ð¦' }
        ]},
        { categoryLabel: 'DocumentaÃ§Ã£o e FormulÃ¡rios', icon: 'ð', items: [
          { label: 'Forms Entrada/SaÃ­da', url: 'https://docs.google.com/forms/d/e/1FAIpQLScJYFkVzCeoQQAkOrmWAistJHPUxzVcWpJ8LV784QZ49WyWfA/viewform', icon: 'ð' },
          { label: 'SolicitaÃ§Ã£o de ManutenÃ§Ã£o', url: 'https://docs.google.com/forms/d/e/1FAIpQLSc2J3LlUWGMMgbUesMe3IPguytFVUrpZaTiZ_3T1TVDTIslqg/viewform', icon: 'ð§' },
          { label: 'Base de Conhecimento', url: 'https://sites.google.com/mercadolivre.com/base-de-conhecimentos-ti/home', icon: 'ð' },
          { label: 'Aplicativos Meli', url: 'https://sites.google.com/view/aplicativosmeli/in%C3%ADcio', icon: 'ð²' },
          { label: 'Passagem de Turno', url: 'https://docs.google.com/spreadsheets/d/1_mIC_cvcrehFxTigNQ8OR9An4EPk5bBVZZdojRFBNek/edit?usp=sharing', icon: 'ð' }
        ]}
      ];

      const itTips = [
        "ITIL: Lembre-se do princÃ­pio 'Focar no Valor'. Toda atividade realizada pela TI deve, de alguma forma, agregar valor para o negÃ³cio e para o cliente.",
        "ITSM: A GestÃ£o de Incidentes busca restaurar o serviÃ§o o mais rÃ¡pido possÃ­vel, enquanto a GestÃ£o de Problemas foca em encontrar e eliminar a causa raiz para prevenir futuros incidentes.",
        "COBIT: A governanÃ§a de TI eficaz (EGIT) requer o equilÃ­brio entre a realizaÃ§Ã£o de benefÃ­cios, a otimizaÃ§Ã£o de riscos e a otimizaÃ§Ã£o de recursos.",
        "Boas PrÃ¡ticas: Documente sempre! Uma documentaÃ§Ã£o clara e concisa hoje economiza horas de troubleshooting para vocÃª (ou para um colega) amanhÃ£.",
        "ITIL 4: ConheÃ§a as quatro dimensÃµes do Gerenciamento de ServiÃ§os: OrganizaÃ§Ãµes e Pessoas, InformaÃ§Ã£o e Tecnologia, Parceiros e Fornecedores, e Fluxos de Valor e Processos.",
        "SeguranÃ§a: Suspeite de todos os e-mails que pedem informaÃ§Ãµes confidenciais ou aÃ§Ãµes urgentes. Verifique sempre o remetente e, na dÃºvida, nÃ£o clique.",
        "Produtividade: Antes de iniciar uma tarefa complexa, dedique 5 minutos para planejar os passos. O planejamento inicial pode economizar muito mais tempo do que o investido.",
        "Atalhos: Use Ctrl+K para pesquisar rapidamente. Pressione ESC para fechar modais. F11 ativa o modo apresentaÃ§Ã£o!",
        "Notas RÃ¡pidas: Duplo clique para editar nota, clique simples para copiar!",
        "Lembretes: Configure lembretes para tarefas recorrentes e nunca mais esqueÃ§a de fazer a passagem de turno!",
        "Temas: Experimente os 4 temas disponÃ­veis no header!",
        "Perfil: Configure seu turno e dias de trabalho clicando no seu nome. Os templates serÃ£o personalizados automaticamente!"
      ];

      // =========================================================
      // ===== DOM refs ==========================================
      // =========================================================
      const contentContainer = document.getElementById('contentContainer');
      const searchInput = document.getElementById('searchInput');
      const clearSearchBtn = document.getElementById('clearSearchBtn');
      const searchStatus = document.getElementById('searchStatus');
      const scrollTopBtn = document.getElementById('scrollTopBtn');

      const linkCountEl = document.getElementById('linkCount');
      const textCountEl = document.getElementById('textCount');
      const copyCountEl = document.getElementById('copyCount');

      // =========================================================
      // ===== Utils =============================================
      // =========================================================
      function escapeHTML(str) {
        const div = document.createElement('div');
        div.textContent = str;
        return div.innerHTML;
      }

      function animateNumber(element, target) {
        if (!element) return;
        const duration = 1200;
        const startTime = performance.now();
        const startValue = parseInt(element.textContent, 10) || 0;

        function update(currentTime) {
          const elapsed = currentTime - startTime;
          const progress = Math.min(elapsed / duration, 1);
          const easeOutExpo = 1 - Math.pow(2, -10 * progress);
          const currentValue = Math.floor(easeOutExpo * (target - startValue) + startValue);
          element.textContent = currentValue;
          if (progress < 1) requestAnimationFrame(update);
        }
        requestAnimationFrame(update);
      }

      function getTimeAgo(timestamp) {
        const now = Date.now();
        const diff = now - timestamp;
        const minutes = Math.floor(diff / 60000);
        const hours = Math.floor(diff / 3600000);
        const days = Math.floor(diff / 86400000);

        if (minutes < 1) return 'Agora mesmo';
        if (minutes < 60) return `HÃ¡ ${minutes} min`;
        if (hours < 24) return `HÃ¡ ${hours}h`;
        return `HÃ¡ ${days}d`;
      }

      function showTooltip(message, targetElement) {
        const tooltip = document.getElementById('tooltip');
        if (!tooltip || !targetElement) return;
        const rect = targetElement.getBoundingClientRect();
        tooltip.innerHTML = escapeHTML(message);
        tooltip.style.left = `${rect.left + rect.width / 2}px`;
        tooltip.style.top = `${rect.top - 10}px`;
        tooltip.style.animation = 'none';
        requestAnimationFrame(() => {
          tooltip.style.animation = 'tooltipShow 2s ease-in-out forwards';
        });
      }

      // =========================================================
      // ===== Forecast 7 dias (usa Ã­cones coerentes) ============
      // =========================================================
      function displayForecast(dailyData, locationName) {
        const { getWeatherIconByDayNight } = window.__app;
        const forecastGridEl = document.getElementById('forecastGrid');
        const forecastModalLocationEl = document.getElementById('forecastModalLocation');
        if (!forecastGridEl || !forecastModalLocationEl) return;

        forecastGridEl.innerHTML = '';
        forecastModalLocationEl.textContent = locationName;

        const weekdays = ['Domingo', 'Segunda', 'TerÃ§a', 'Quarta', 'Quinta', 'Sexta', 'SÃ¡bado'];
        const weekdaysShort = ['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'SÃ¡b'];

        dailyData.time.forEach((dateStr, index) => {
          if (index === 0) return;
          if (index > 7) return;

          const date = new Date(dateStr + 'T00:00:00');
          const dayName = window.innerWidth > 768 ? weekdays[date.getDay()] : weekdaysShort[date.getDay()];

          const icon = getWeatherIconByDayNight(dailyData.weathercode[index], true);
          const maxTemp = Math.round(dailyData.temperature_2m_max[index]);
          const minTemp = Math.round(dailyData.temperature_2m_min[index]);
          const precipProb = dailyData.precipitation_probability_max[index] || 0;
          const windSpeed = Math.round(dailyData.windspeed_10m_max[index]);

          const dayEl = document.createElement('div');
          dayEl.className = 'forecast-day';
          dayEl.innerHTML = `
            <div class="forecast-day-name">${dayName}</div>
            <div class="forecast-day-icon">${icon}</div>
            <div class="forecast-day-temps">
              <span>${maxTemp}Â°</span>
              <span class="temp-label">MÃ¡xima</span>
              <div style="font-size: 0.9rem; color: var(--ml-text-tertiary); margin-top: 0.35rem; font-weight: 700;">${minTemp}Â° MÃ­nima</div>
              ${precipProb > 10 ? `<div class="forecast-day-precip">â ${precipProb}%</div>` : ''}
              ${windSpeed > 20 ? `<div style="font-size: 0.7rem; color: var(--ml-text-light); margin-top: 0.25rem; font-weight: 600;">ð¨ ${windSpeed}km/h</div>` : ''}
            </div>
          `;
          forecastGridEl.appendChild(dayEl);
        });
      }
      window.displayForecast = displayForecast;

      // =========================================================
      // ===== Stats + Tip =======================================
      // =========================================================
      let copyCount = parseInt(localStorage.getItem('copyCount') || '0', 10);

      let totalLinks = 0;
      linkCategories.forEach(cat => totalLinks += cat.items.length);

      function displayTipOfTheDay() {
        const tip = itTips[Math.floor(Math.random() * itTips.length)];
        const tipText = document.getElementById('tipText');
        if (tipText) tipText.textContent = tip;
      }

      function updateStats() {
        const templates = getReadyTextsTemplate();
        animateNumber(linkCountEl, totalLinks);
        animateNumber(textCountEl, templates.length);
        animateNumber(copyCountEl, copyCount);
        localStorage.setItem('copyCount', String(copyCount));
      }

      // =========================================================
      // ===== Notas =============================================
      // =========================================================
      let notes = JSON.parse(localStorage.getItem('notes') || '[]');
      const notesGrid = document.getElementById('notesGrid');
      const addNoteBtn = document.getElementById('addNoteBtn');
      const notesCountEl = document.getElementById('notesCount');
      const mobileNotesCountEl = document.getElementById('mobileNotesCount');

      const noteColors = ['#FFF4B3','#E8F1FF','#E8F7F0','#FFE0E0','#F0E8FF','#FFE8D5'];
      function getRandomColor() { return noteColors[Math.floor(Math.random() * noteColors.length)]; }

      function updateNotesCount() {
        animateNumber(notesCountEl, notes.length);
        if (mobileNotesCountEl) mobileNotesCountEl.textContent = `${notes.length} ${notes.length === 1 ? 'nota' : 'notas'}`;
      }

      function renderNotes() {
        if (!notesGrid) return;

        if (notes.length === 0) {
          notesGrid.innerHTML = '<div class="notes-empty">Clique em "+ Nova Nota" para comeÃ§ar</div>';
          return;
        }

        notesGrid.innerHTML = '';
        notes.forEach((note, index) => {
          const noteEl = document.createElement('div');
          noteEl.className = 'note-item';
          noteEl.style.animationDelay = `${index * 0.05}s`;
          noteEl.style.borderLeftColor = note.color;
          noteEl.style.borderLeftWidth = '4px';

          const timeAgo = getTimeAgo(note.timestamp);

          noteEl.innerHTML = `
            <div class="note-header">
              <div class="note-color" style="background: ${note.color};"></div>
              <button class="note-delete" data-note-delete="${note.id}" title="Excluir nota">ðï¸</button>
            </div>
            <div class="note-content">${escapeHTML(note.content)}</div>
            <div class="note-timestamp">ð ${timeAgo}</div>
          `;

          noteEl.addEventListener('dblclick', () => {
            const newContent = prompt('âï¸ Editar nota:', note.content);
            if (newContent && newContent.trim()) {
              note.content = newContent.trim();
              note.timestamp = Date.now();
              localStorage.setItem('notes', JSON.stringify(notes));
              renderNotes();
              showNotification('âï¸ Nota atualizada!');
            }
          });

          noteEl.addEventListener('click', async (e) => {
            if (e.target?.dataset?.noteDelete) return;

            const ok = await window.__app.copyToClipboard(note.content);
            if (ok) {
              showNotification('ð Nota copiada para a Ã¡rea de transferÃªncia!');
              window.__app.beep();
            } else {
              alert('â NÃ£o foi possÃ­vel copiar automaticamente. Copie manualmente.');
            }
          });

          notesGrid.appendChild(noteEl);
        });

        notesGrid.querySelectorAll('[data-note-delete]').forEach(btn => {
          btn.addEventListener('click', (e) => {
            const id = parseInt(e.currentTarget.dataset.noteDelete, 10);
            if (confirm('ðï¸ Deseja realmente excluir esta nota?')) {
              notes = notes.filter(n => n.id !== id);
              localStorage.setItem('notes', JSON.stringify(notes));
              renderNotes();
              updateNotesCount();
              showNotification('ðï¸ Nota excluÃ­da!');
            }
          });
        });
      }

      function addNote() {
        const content = prompt('ð Digite o conteÃºdo da nota:\n\n(Use para lembretes, senhas temporÃ¡rias, observaÃ§Ãµes importantes)');
        if (content && content.trim()) {
          const note = { id: Date.now(), content: content.trim(), timestamp: Date.now(), color: getRandomColor() };
          notes.unshift(note);
          localStorage.setItem('notes', JSON.stringify(notes));
          renderNotes();
          updateNotesCount();
          showNotification('â Nota criada com sucesso!');
          window.__app.beep();
        }
      }

      addNoteBtn?.addEventListener('click', addNote);
      document.getElementById('mobileNotesBtn')?.addEventListener('click', () => {
        closeMobileMenu();
        document.getElementById('notesCard')?.scrollIntoView({ behavior: 'smooth' });
      });

      renderNotes();
      updateNotesCount();

      // =========================================================
      // ===== Lembretes =========================================
      // =========================================================
      let reminders = JSON.parse(localStorage.getItem('reminders') || '[]');

      if (reminders.length === 0) {
        reminders = [
          { id: 1, title: 'Passagem de Turno', time: '21:45', days: [1,2,3,4,5], enabled: true, icon: 'ð' },
          { id: 2, title: 'Verificar Tickets Pendentes', time: '14:00', days: [1,2,3,4,5], enabled: true, icon: 'ð«' },
          { id: 3, title: 'Backup de Dados', time: '18:00', days: [5], enabled: false, icon: 'ð¾' }
        ];
        localStorage.setItem('reminders', JSON.stringify(reminders));
      }

      const remindersList = document.getElementById('remindersList');
      const addReminderBtn = document.getElementById('addReminderBtn');
      const mobileRemindersCountEl = document.getElementById('mobileRemindersCount');
      const weekdayNames = ['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'SÃ¡b'];

      function renderReminders() {
        const activeCount = reminders.filter(r => r.enabled).length;
        if (mobileRemindersCountEl) mobileRemindersCountEl.textContent = `${activeCount} ${activeCount === 1 ? 'ativo' : 'ativos'}`;

        if (!remindersList) return;

        if (reminders.length === 0) {
          remindersList.innerHTML = '<div class="reminders-empty">Clique em "+ Novo Lembrete" para criar</div>';
          return;
        }

        remindersList.innerHTML = '';
        reminders.forEach(reminder => {
          const daysText = reminder.days.map(d => weekdayNames[d]).join(', ');
          const reminderEl = document.createElement('div');
          reminderEl.className = 'reminder-item';
          reminderEl.innerHTML = `
            <div class="reminder-toggle ${reminder.enabled ? 'active' : ''}" data-reminder-toggle="${reminder.id}"></div>
            <div class="reminder-info">
              <div class="reminder-title-text">${reminder.icon} ${escapeHTML(reminder.title)}</div>
              <div class="reminder-schedule">â° ${reminder.time} | ð ${daysText}</div>
            </div>
            <button class="reminder-delete" data-reminder-delete="${reminder.id}" title="Excluir lembrete">ðï¸</button>
          `;
          remindersList.appendChild(reminderEl);
        });

        remindersList.querySelectorAll('[data-reminder-toggle]').forEach(tg => {
          tg.addEventListener('click', (e) => {
            const id = parseInt(e.currentTarget.dataset.reminderToggle, 10);
            const r = reminders.find(x => x.id === id);
            if (!r) return;
            r.enabled = !r.enabled;
            localStorage.setItem('reminders', JSON.stringify(reminders));
            renderReminders();
            showNotification(r.enabled ? 'ð Lembrete ativado!' : 'ð Lembrete desativado!');
          });
        });

        remindersList.querySelectorAll('[data-reminder-delete]').forEach(btn => {
          btn.addEventListener('click', (e) => {
            const id = parseInt(e.currentTarget.dataset.reminderDelete, 10);
            if (confirm('ðï¸ Deseja realmente excluir este lembrete?')) {
              reminders = reminders.filter(r => r.id !== id);
              localStorage.setItem('reminders', JSON.stringify(reminders));
              renderReminders();
              showNotification('ðï¸ Lembrete excluÃ­do!');
            }
          });
        });
      }

      function addReminder() {
        const title = prompt('ð TÃ­tulo do lembrete:\n\nExemplo: ReuniÃ£o diÃ¡ria, Backup semanal, etc.');
        if (!title || !title.trim()) return;

        const time = prompt('â° HorÃ¡rio (HH:MM):\n\nExemplo: 14:30, 09:00, 18:45', '14:00');
        if (!time || !time.match(/^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/)) {
          alert('â ï¸ HorÃ¡rio invÃ¡lido! Use o formato HH:MM (ex: 14:30)');
          return;
        }

        const daysInput = prompt('ð Dias da semana (nÃºmeros separados por vÃ­rgula):\n\n1=Seg, 2=Ter, 3=Qua, 4=Qui, 5=Sex, 6=SÃ¡b, 0=Dom\n\nExemplo: 1,2,3,4,5', '1,2,3,4,5');
        if (!daysInput) return;

        const days = daysInput.split(',').map(d => parseInt(d.trim(), 10)).filter(d => d >= 0 && d <= 6);
        if (days.length === 0) {
          alert('â ï¸ Nenhum dia vÃ¡lido selecionado!');
          return;
        }

        reminders.push({ id: Date.now(), title: title.trim(), time, days, enabled: true, icon: 'ð' });
        localStorage.setItem('reminders', JSON.stringify(reminders));
        renderReminders();
        showNotification('â Lembrete criado com sucesso!');
        window.__app.beep();
      }

      addReminderBtn?.addEventListener('click', addReminder);
      document.getElementById('mobileRemindersBtn')?.addEventListener('click', () => {
        closeMobileMenu();
        document.getElementById('remindersCard')?.scrollIntoView({ behavior: 'smooth' });
      });

      function checkReminders() {
        const now = new Date();
        const currentTime = `${String(now.getHours()).padStart(2,'0')}:${String(now.getMinutes()).padStart(2,'0')}`;
        const currentDay = now.getDay();

        reminders.forEach(reminder => {
          if (reminder.enabled && reminder.time === currentTime && reminder.days.includes(currentDay)) {
            const lastNotification = localStorage.getItem(`reminder_${reminder.id}_last`);
            const today = now.toDateString();
            if (lastNotification !== today) {
              showNotification(`${reminder.icon} ${reminder.title}`, { tag: `reminder_${reminder.id}` });
              window.__app.beep();
              localStorage.setItem(`reminder_${reminder.id}_last`, today);
            }
          }
        });
      }

      setInterval(checkReminders, 60000);
      renderReminders();

      // =========================================================
      // ===== HistÃ³rico =========================================
      // =========================================================
      function getLinkHistory() {
        return JSON.parse(localStorage.getItem('linkHistory') || '[]');
      }
      function saveLinkHistory(history) {
        localStorage.setItem('linkHistory', JSON.stringify(history));
      }

      function trackLinkAccess(url, label, icon) {
        let history = getLinkHistory();
        history = history.filter(item => item.url !== url);
        history.unshift({ url, label, icon, timestamp: Date.now() });
        history = history.slice(0, 10);
        saveLinkHistory(history);
        updateHistoryUI();
        updateHistoryCount();
      }

      function updateHistoryUI() {
        const historyCard = document.getElementById('historyCard');
        const historyList = document.getElementById('historyList');
        const history = getLinkHistory();

        if (!historyCard || !historyList) return;

        if (history.length === 0) {
          historyCard.style.display = 'none';
          return;
        }

        historyCard.style.display = 'block';
        historyList.innerHTML = '';

        history.forEach(item => {
          const timeAgo = getTimeAgo(item.timestamp);
          const historyItem = document.createElement('div');
          historyItem.className = 'history-item';
          historyItem.innerHTML = `
            <div class="history-item-info">
              <span class="history-item-icon">${item.icon}</span>
              <div class="history-item-details">
                <div class="history-item-label">${escapeHTML(item.label)}</div>
                <div class="history-item-time">${timeAgo}</div>
              </div>
            </div>
          `;
          historyItem.addEventListener('click', () => {
            window.open(item.url, '_blank', 'noopener,noreferrer');
            trackLinkAccess(item.url, item.label, item.icon);
          });
          historyList.appendChild(historyItem);
        });
      }

      function updateHistoryCount() {
        const historyCountEl = document.getElementById('historyCount');
        animateNumber(historyCountEl, getLinkHistory().length);
      }

      document.getElementById('clearHistoryBtn')?.addEventListener('click', () => {
        if (confirm('ðï¸ Deseja limpar todo o histÃ³rico de links acessados?')) {
          localStorage.removeItem('linkHistory');
          updateHistoryUI();
          updateHistoryCount();
          showNotification('ðï¸ HistÃ³rico limpo com sucesso!');
        }
      });

      // expor para uso em eventos
      window.__portal = {
        linkCategories,
        trackLinkAccess
      };

      // =========================================================
      // ===== Templates personalizados ==========================
      // =========================================================
function getReadyTextsTemplate() {
  const now = new Date();
  const dayOfWeek = ['Domingo', 'Segunda-feira', 'TerÃ§a-feira', 'Quarta-feira', 'Quinta-feira', 'Sexta-feira', 'SÃ¡bado'][now.getDay()];
  const currentDateTime = `${dayOfWeek}, ${now.toLocaleDateString('pt-BR')} Ã s ${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}`;

  const workDaysText = (window.__app.userProfile.workDaysNames && window.__app.userProfile.workDaysNames.length > 0)
    ? window.__app.userProfile.workDaysNames.join(', ')
    : 'Segunda a Sexta-feira';

  const shiftInfo = (window.__app.userProfile.shift && window.__app.userProfile.shiftTime)
    ? `${window.__app.userProfile.shift} (${window.__app.userProfile.shiftTime})`
    : 'Turno 2: 13h Ã s 22h';

  return [
    {
      id: 'boas_vindas_personalizado',
      label: `Boas-vindas / InÃ­cio do atendimento (${window.__app.userProfile.name} â IS-FIELD ${window.__app.userProfile.shift || 'T2'})`,
      text: `Prezado(a),

Meu nome Ã© ${window.__app.userProfile.name}, integrante da equipe IS-FIELD. Iniciei a anÃ¡lise do seu ticket neste momento. Caso sejam necessÃ¡rias informaÃ§Ãµes adicionais ou esclarecimentos sobre o chamado, entrarei em contato por meio do Google Chat ð¬.

ð Data/Hora: ${currentDateTime}
ð Turno: ${shiftInfo}
ð Dias de atendimento: ${workDaysText}

Permanecemos Ã  disposiÃ§Ã£o para suporte.

Atenciosamente,
${window.__app.userProfile.name} | Equipe IS-FIELD ${window.__app.userProfile.shift || 'T2'} ð¤ðð`
    },
    {
      id: 'chamado_resolvido_retirada',
      label: 'Chamado Resolvido / Retirada de Equipamento',
      text: `Prezado(a),

â Seu chamado foi resolvido com sucesso!

ð¦ O equipamento jÃ¡ estÃ¡ disponÃ­vel para retirada na Ilha de TI.

ð InstruÃ§Ãµes:
â¢ Apresentar o nÃºmero deste chamado na ilha de TI
â¢ Prazo: 10 dias corridos
â¢ HorÃ¡rio de atendimento: ${shiftInfo}
â¢ Dias: ${workDaysText}

â ï¸ IMPORTANTE: Caso nÃ£o seja retirado no prazo, o equipamento serÃ¡ recolhido para o estoque de IS.

Qualquer dÃºvida, estamos Ã  disposiÃ§Ã£o.

Atenciosamente,
${window.__app.userProfile.name} | Equipe IS-FIELD ${window.__app.userProfile.shift || 'T2'} ð¤ð`
    },
    {
      id: 'substituicao_perda_loss',
      label: 'SubstituiÃ§Ã£o por Perda â Direcionamento para LOSS',
      text: `Prezado(a),

Informamos que o time de IS-FIELD nÃ£o realiza fluxo de substituiÃ§Ã£o por perda de equipamentos da operaÃ§Ã£o. Para dar continuidade ao processo, favor acionar diretamente o time de LOSS (Loss Prevention).

Permanecemos Ã  disposiÃ§Ã£o para demais suportes tÃ©cnicos.

Atenciosamente,
${window.__app.userProfile.name} | Equipe IS-FIELD ${window.__app.userProfile.shift || 'T2'} ð¤`
    },
    {
      id: 'trazer_equip_validacao_simples',
      label: 'Trazer Equipamento para ValidaÃ§Ã£o (Simples)',
      text: `Prezado(a),

Para darmos continuidade ao atendimento, solicitamos que:

ð Traga o equipamento atÃ© a Ilha de IS
ð·ï¸ Identifique o equipamento com o nÃºmero deste chamado
ð HorÃ¡rio de atendimento: ${shiftInfo}
ð Dias: ${workDaysText}

Nossa equipe realizarÃ¡ a validaÃ§Ã£o e darÃ¡ o retorno sobre a soluÃ§Ã£o aplicada.

Aguardamos o equipamento para anÃ¡lise.

Atenciosamente,
${window.__app.userProfile.name} | Equipe IS-FIELD ${window.__app.userProfile.shift || 'T2'} ð¤ð`
    },
    {
      id: 'coleta_informacoes_atendimento',
      label: 'Coleta de InformaÃ§Ãµes para Atendimento',
      text: `Prezado(a),

Para darmos continuidade ao seu atendimento de forma eficiente, solicitamos que nos forneÃ§a as seguintes informaÃ§Ãµes:

ð INFORMAÃÃES NECESSÃRIAS:

ð¢ Setor ou Local:

ð¢ NÂº da Bancada:

â Erro/Problema:

ð ObservaÃ§Ãµes adicionais:

ð¸ Foto evidÃªncia:

Quanto mais detalhes vocÃª fornecer, mais rÃ¡pido conseguiremos resolver o seu chamado.

â° Atendimento: ${shiftInfo} | ${workDaysText}

Aguardamos seu retorno.

Atenciosamente,
${window.__app.userProfile.name} | Equipe IS-FIELD ${window.__app.userProfile.shift || 'T2'} ð¤ð`
    },
    {
      id: 'trazer_equip_validacao_assets',
      label: 'ValidaÃ§Ã£o de Equipamento + PossÃ­vel Envio para Assets',
      text: `Prezado(a),

Para anÃ¡lise tÃ©cnica do equipamento, solicitamos que:

ð PROCEDIMENTO:
1. Trazer o equipamento atÃ© a Ilha de IS
2. Identificar com o nÃºmero deste chamado
3. Nossa equipe realizarÃ¡ validaÃ§Ã£o tÃ©cnica completa

ð HorÃ¡rio: ${shiftInfo}
ð Dias: ${workDaysText}

ð ANÃLISE:
â¢ O equipamento serÃ¡ recolhido para anÃ¡lise detalhada
â¢ ApÃ³s validaÃ§Ã£o, serÃ¡ devolvido para a operaÃ§Ã£o

â ï¸ OBSERVAÃÃO IMPORTANTE:
Caso seja identificado dano no equipamento, ele serÃ¡ encaminhado ao time de Assets para reparo ou substituiÃ§Ã£o. Aguardaremos a reposiÃ§Ã£o antes de realizar a devoluÃ§Ã£o.

Atenciosamente,
${window.__app.userProfile.name} | Equipe IS-FIELD ${window.__app.userProfile.shift || 'T2'} ð¤ð`
    },
    {
      id: 'alta_demanda_notebooks_lista_espera',
      label: 'Alta Demanda de Notebooks / Lista de Espera',
      text: `Prezado(a),

ð COMUNICADO - Alta Demanda de Notebooks

Informamos que estamos com um volume elevado de solicitaÃ§Ãµes de notebooks e, no momento, o atendimento estÃ¡ condicionado Ã  disponibilidade em nosso estoque.

ð PROCEDIMENTO:
Para otimizar o fluxo de atendimento, seu chamado serÃ¡ encerrado neste momento. Entretanto:

â Seu nome serÃ¡ registrado em nossa planilha de controle interno
ð Entraremos em contato assim que houver equipamento disponÃ­vel
â° HorÃ¡rio de contato: ${shiftInfo}
ð Dias: ${workDaysText}

ð IMPORTANTE:
VocÃª nÃ£o precisarÃ¡ abrir novo chamado. Nossa equipe entrarÃ¡ em contato proativamente quando tivermos disponibilidade.

Agradecemos pela compreensÃ£o e paciÃªncia.

Permanecemos Ã  disposiÃ§Ã£o para demais suportes.

Atenciosamente,
${window.__app.userProfile.name} | Equipe IS-FIELD ${window.__app.userProfile.shift || 'T2'} ð¤ðð`
    },
    {
      id: 'passagem_turno',
      label: `Passagem de Turno ${window.__app.userProfile.shift || 'T2'}`,
      text: `ð PASSAGEM DE TURNO - IS-FIELD ${window.__app.userProfile.shift || 'T2'}

ð¤ ResponsÃ¡vel: ${window.__app.userProfile.name}
ð Data: ${currentDateTime}
ð Turno: ${shiftInfo}

â ATIVIDADES REALIZADAS:
â¢ 
â¢ 
â¢ 

â ï¸ PENDÃNCIAS:
â¢ 
â¢ 

ð CHAMADOS:
â¢ Resolvidos: 
â¢ Em andamento: 
â¢ Aguardando retorno: 

ð§ EQUIPAMENTOS:
â¢ Retirados para anÃ¡lise: 
â¢ DisponÃ­veis para devoluÃ§Ã£o: 

ð¬ OBSERVAÃÃES IMPORTANTES:
â¢ 

---
Passagem realizada por: ${window.__app.userProfile.name} | ${window.__app.userProfile.shift || 'T2'} ð¤ð`
    }
  ];
}
      window.getReadyTextsTemplate = getReadyTextsTemplate;

      // =========================================================
      // ===== Init do topo (tip/stats/histÃ³rico) ================
      // =========================================================
      displayTipOfTheDay();
      updateStats();
      updateHistoryUI();
      updateHistoryCount();
      // =========================================================
      // ===== Autocomplete + Busca ==============================
      // =========================================================
      const searchSuggestions = document.getElementById('searchSuggestions');

      function highlightMatch(text, query) {
        const escapedText = escapeHTML(text);
        const escapedQuery = query.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
        const regex = new RegExp(`(${escapedQuery})`, 'gi');
        return escapedText.replace(regex, '<mark>$1</mark>');
      }

      function showSuggestions(query) {
        if (!searchSuggestions) return;

        if (query.length < 2) {
          searchSuggestions.classList.add('hidden');
          searchSuggestions.innerHTML = '';
          return;
        }

        const lowerQuery = query.toLowerCase();
        const matches = [];

        linkCategories.forEach(cat => {
          cat.items.forEach(item => {
            if (item.label.toLowerCase().includes(lowerQuery) || item.url.toLowerCase().includes(lowerQuery)) {
              matches.push({ ...item, category: cat.categoryLabel, type: 'link' });
            }
          });
        });

        const readyTextsTemplate = getReadyTextsTemplate();
        readyTextsTemplate.forEach(item => {
          if (item.label.toLowerCase().includes(lowerQuery) || item.text.toLowerCase().includes(lowerQuery)) {
            matches.push({ label: item.label, icon: 'ð', category: 'Templates de Texto', type: 'text', text: item.text });
          }
        });

        notes.forEach(note => {
          if (note.content.toLowerCase().includes(lowerQuery)) {
            matches.push({
              label: note.content.substring(0, 50) + (note.content.length > 50 ? '...' : ''),
              icon: 'ð',
              category: 'Notas RÃ¡pidas',
              type: 'note',
              content: note.content
            });
          }
        });

        if (matches.length === 0) { searchSuggestions.classList.add('hidden'); return; }
        const limitedMatches = matches.slice(0, 8);

        searchSuggestions.innerHTML = limitedMatches.map(match => `
          <div class="suggestion-item" data-type="${match.type}" data-url="${match.url || ''}" data-text="${escapeHTML(match.text || match.content || '')}">
            <span class="suggestion-icon">${match.icon}</span>
            <div class="suggestion-details">
              <div class="suggestion-label">${highlightMatch(match.label, query)}</div>
              <div class="suggestion-category">${match.category}</div>
            </div>
            <span class="suggestion-badge">${match.type === 'link' ? 'Link' : match.type === 'text' ? 'Template' : 'Nota'}</span>
          </div>
        `).join('');

        searchSuggestions.classList.remove('hidden');

        searchSuggestions.querySelectorAll('.suggestion-item').forEach(item => {
          item.addEventListener('click', async () => {
            const type = item.dataset.type;
            const url = item.dataset.url;
            const text = item.dataset.text;

            if (type === 'link' && url) {
              window.open(url, '_blank', 'noopener,noreferrer');
              window.__portal.trackLinkAccess(url, item.querySelector('.suggestion-label').textContent, item.querySelector('.suggestion-icon').textContent);
            } else if ((type === 'text' || type === 'note') && text) {
              const ok = await window.__app.copyToClipboard(text);
              if (ok) {
                showNotification('ð Texto copiado para a Ã¡rea de transferÃªncia!');
                window.__app.beep();
                copyCount++;
                updateStats();
              } else {
                alert('â NÃ£o foi possÃ­vel copiar automaticamente. Copie manualmente.');
              }
            }

            searchSuggestions.classList.add('hidden');
            searchInput.value = '';
            clearSearchBtn.classList.remove('active');
          });
        });
      }

      // =========================================================
      // ===== populateContent (links + templates) ================
      // =========================================================
      function populateContent(filter = '') {
        if (!contentContainer) return;

        contentContainer.innerHTML = '';
        const lowerCaseFilter = (filter || '').toLowerCase().trim();
        let hasVisibleContent = false;

        const readyTextsTemplate = getReadyTextsTemplate();
        updateStats();

        const highlightText = (text, highlight) => {
          if (!highlight) return escapeHTML(text);
          const escapedText = escapeHTML(text);
          const escapedHighlight = highlight.replace(/([.*+?^=!:${}()|\[\]\/\\])/g, "\\$1");
          return escapedText.replace(new RegExp(escapedHighlight, 'gi'), match => `<mark>${match}</mark>`);
        };

        // Links
        linkCategories.forEach(category => {
          const filteredItems = category.items.filter(item =>
            item.label.toLowerCase().includes(lowerCaseFilter) ||
            category.categoryLabel.toLowerCase().includes(lowerCaseFilter) ||
            item.url.toLowerCase().includes(lowerCaseFilter)
          );

          if (filteredItems.length > 0) {
            hasVisibleContent = true;

            const section = document.createElement('section');
            section.className = 'content-section';
            section.innerHTML = `
              <div class="section-header">
                <div class="section-icon">${category.icon}</div>
                <div class="section-title-group">
                  <h2 class="section-title">${category.categoryLabel}</h2>
                  <p class="section-subtitle">${filteredItems.length} ${filteredItems.length === 1 ? 'recurso encontrado' : 'recursos encontrados'}</p>
                </div>
              </div>
            `;

            const grid = document.createElement('div');
            grid.className = 'links-grid';

            filteredItems.forEach(item => {
              const card = document.createElement('div');
              card.className = 'link-card';
              const highlightedLabel = highlightText(item.label, lowerCaseFilter);

              card.innerHTML = `
                <div class="link-content">
                  <div class="link-icon">${item.icon}</div>
                  <div class="link-details">
                    <span class="link-title">${highlightedLabel}</span>
                    <span class="link-url">${escapeHTML(item.url)}</span>
                  </div>
                </div>
                <div class="link-actions">
                  <a href="${item.url}" target="_blank" rel="noopener noreferrer"
                     class="btn btn-primary"
                     data-url="${item.url}"
                     data-label="${escapeHTML(item.label)}"
                     data-icon="${item.icon}">Acessar</a>
                  <button class="btn btn-qrcode"
                          data-url="${item.url}"
                          data-title="${escapeHTML(item.label)}"
                          data-action="qrcode"
                          title="Gerar QR Code">ð±</button>
                  <button class="btn btn-secondary"
                          data-link="${item.url}"
                          data-action="copy"
                          title="Copiar link">ð</button>
                </div>
              `;
              grid.appendChild(card);
            });

            section.appendChild(grid);
            contentContainer.appendChild(section);
          }
        });

        // Templates
        const filteredTexts = readyTextsTemplate.filter(item =>
          item.text.toLowerCase().includes(lowerCaseFilter) ||
          item.label.toLowerCase().includes(lowerCaseFilter)
        );

        if (filteredTexts.length > 0) {
          hasVisibleContent = true;

          const section = document.createElement('section');
          section.className = 'content-section';
          section.innerHTML = `
            <div class="section-header">
              <div class="section-icon">ð</div>
              <div class="section-title-group">
                <h2 class="section-title">Templates de Texto</h2>
                <p class="section-subtitle">Personalizados para ${escapeHTML(window.__app.userProfile.name)}</p>
              </div>
            </div>
          `;

          filteredTexts.forEach(item => {
            const card = document.createElement('div');
            card.className = 'text-card';
            const highlightedLabel = highlightText(item.label, lowerCaseFilter);
            const highlightedContent = highlightText(item.text, lowerCaseFilter).replace(/\n/g, '<br>');

            card.innerHTML = `
              <div class="text-card-header">
                <h3 class="text-card-title">${highlightedLabel}</h3>
                <span class="text-badge">Personalizado</span>
              </div>
              <div class="text-content"
                   data-text="${escapeHTML(item.text)}"
                   data-action="copy-text"
                   role="button"
                   tabindex="0"
                   title="Clique para copiar">
                <span class="copy-feedback-icon">â</span>
                ${highlightedContent}
              </div>
            `;
            section.appendChild(card);
          });

          contentContainer.appendChild(section);
        }

        if (searchStatus) {
          searchStatus.classList.toggle('hidden', !filter);
          searchStatus.textContent = filter
            ? (hasVisibleContent ? `â Encontrados resultados para "${escapeHTML(filter)}"` : `â Nenhum resultado encontrado para "${escapeHTML(filter)}"`)
            : '';
        }

        init3DEffect();
      }
      window.populateContent = populateContent;

      // =========================================================
      // ===== Search handlers ===================================
      // =========================================================
      document.addEventListener('click', (e) => {
        if (!searchInput?.contains(e.target) && !searchSuggestions?.contains(e.target)) {
          searchSuggestions?.classList.add('hidden');
        }
      });

      let searchTimeout;
      const handleSearch = () => {
        clearTimeout(searchTimeout);
        searchTimeout = setTimeout(() => {
          const searchTerm = searchInput.value || '';

          if (searchTerm.length >= 2) showSuggestions(searchTerm);
          else searchSuggestions?.classList.add('hidden');

          populateContent(searchTerm);
          clearSearchBtn.classList.toggle('active', searchTerm.length > 0);

          const url = new URL(window.location);
          searchTerm ? url.searchParams.set('q', searchTerm) : url.searchParams.delete('q');
          window.history.replaceState({}, '', url);
        }, 250);
      };

      searchInput?.addEventListener('input', handleSearch);
      searchInput?.addEventListener('focus', () => {
        if ((searchInput.value || '').length >= 2) showSuggestions(searchInput.value);
      });

      clearSearchBtn?.addEventListener('click', () => {
        searchInput.value = '';
        handleSearch();
        searchInput.focus();
        searchSuggestions?.classList.add('hidden');
      });

      // =========================================================
      // ===== ConteÃºdo: copy/qrcode tracking ====================
      // =========================================================
      contentContainer?.addEventListener('click', async (event) => {
        const target = event.target.closest('[data-action]');

        if (!target) {
          const primaryBtn = event.target.closest('.btn-primary');
          if (primaryBtn) {
            const url = primaryBtn.dataset.url;
            const label = primaryBtn.dataset.label;
            const icon = primaryBtn.dataset.icon;
            if (url && label && icon) window.__portal.trackLinkAccess(url, label, icon);
          }
          return;
        }

        const action = target.dataset.action;

        if (action === 'qrcode') {
          window.__openQRCodeModal(target.dataset.url, target.dataset.title);

        } else if (action === 'copy') {
          const ok = await window.__app.copyToClipboard(target.dataset.link);
          if (ok) {
            window.__app.beep();
            showTooltip('â Link copiado!', target);
            copyCount++;
            updateStats();
          } else {
            alert('â NÃ£o foi possÃ­vel copiar automaticamente. Copie manualmente.');
          }

        } else if (action === 'copy-text') {
          const textToCopy = target.dataset.text;
          const ok = await window.__app.copyToClipboard(textToCopy);
          if (ok) {
            window.__app.beep();
            target.classList.add('copied-success');
            copyCount++;
            updateStats();
            setTimeout(() => target.classList.remove('copied-success'), 1200);
          } else {
            alert('â NÃ£o foi possÃ­vel copiar automaticamente. Copie manualmente.');
          }
        }
      });

      // =========================================================
      // ===== Scroll top ========================================
      // =========================================================
      window.addEventListener('scroll', () => {
        scrollTopBtn?.classList.toggle('visible', window.scrollY > 400);
      }, { passive: true });

      scrollTopBtn?.addEventListener('click', () => {
        window.scrollTo({ top: 0, behavior: 'smooth' });
      });

      // =========================================================
      // ===== 3D cards ==========================================
      // =========================================================
      function init3DEffect() {
        const cards = document.querySelectorAll('.link-card');
        cards.forEach(card => {
          card.addEventListener('mousemove', (e) => {
            const rect = card.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            const { width, height } = rect;
            const rotateX = (y / height - 0.5) * -14;
            const rotateY = (x / width - 0.5) * 14;
            card.style.transform = `scale(1.03) rotateX(${rotateX}deg) rotateY(${rotateY}deg)`;
          });
          card.addEventListener('mouseleave', () => {
            card.style.transform = 'scale(1) rotateX(0deg) rotateY(0deg)';
          });
        });
      }

      // =========================================================
      // ===== Init geral ========================================
      // =========================================================
      const searchTermFromUrl = new URLSearchParams(window.location.search).get('q');
      if (searchTermFromUrl && searchInput) searchInput.value = searchTermFromUrl;

      setTimeout(() => {
        populateContent(searchInput?.value || '');
        clearSearchBtn?.classList.toggle('active', (searchInput?.value || '').length > 0);
        init3DEffect();
      }, 800);

      setTimeout(() => {
        const loadingScreen = document.querySelector('.loading-screen');
        if (loadingScreen) loadingScreen.style.display = 'none';
      }, 1500);

      setTimeout(() => {
        showNotification(`ð Bem-vindo(a), ${window.__app.userProfile.name}!\n\nâ¨ Novas funcionalidades:\nð¤ Perfil Personalizado (Turno + Dias)\nð Notas RÃ¡pidas\nð Sistema de Lembretes\nð Busca com Autocomplete\nð¨ 4 Temas DisponÃ­veis\nâï¸ Clima Detalhado`, {
          tag: 'welcome'
        });
      }, 2500);

      // Confete: 10 cliques no logo
      let logoClicks = 0;
      document.querySelector('.brand-logo')?.addEventListener('click', () => {
        logoClicks++;
        if (logoClicks === 10) {
          showNotification('ð Easter Egg Desbloqueado! VocÃª encontrou o confete secreto do Mercado Livre!');
          createConfetti();
          logoClicks = 0;
        }
        setTimeout(() => logoClicks = 0, 3000);
      });

      function createConfetti() {
        const colors = ['#FFE600', '#2D3277', '#3483FA', '#00A650'];
        for (let i = 0; i < 50; i++) {
          const confetti = document.createElement('div');
          confetti.style.position = 'fixed';
          confetti.style.width = '10px';
          confetti.style.height = '10px';
          confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
          confetti.style.left = Math.random() * 100 + '%';
          confetti.style.top = '-10px';
          confetti.style.opacity = '1';
          confetti.style.zIndex = '10000';
          confetti.style.borderRadius = '50%';
          confetti.style.pointerEvents = 'none';
          document.body.appendChild(confetti);

          const duration = Math.random() * 3 + 2;
          const xMovement = (Math.random() - 0.5) * 200;

          confetti.animate([
            { transform: 'translateY(0) translateX(0) rotate(0deg)', opacity: 1 },
            { transform: `translateY(100vh) translateX(${xMovement}px) rotate(720deg)`, opacity: 0 }
          ], {
            duration: duration * 1000,
            easing: 'cubic-bezier(0.25, 0.46, 0.45, 0.94)'
          }).onfinish = () => confetti.remove();
        }
      }

    });
  </script>

</body>
</html>
